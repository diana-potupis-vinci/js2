"use strict";(self.webpackChunkmyjscourse=self.webpackChunkmyjscourse||[]).push([[836],{1746:function(e,n,t){t.r(n),t.d(n,{default:function(){return S}});var l=t(3905),r=t(7294);function a(e){const n=Object.assign({h1:"h1",p:"p",br:"br",strong:"strong",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",code:"code",a:"a",pre:"pre",ul:"ul",li:"li",em:"em",h2:"h2",h4:"h4"},(0,l.ah)(),e.components),{InternalPageMenu:t,PathViewer:a,PathViewerItem:o,InternalPageMenuItem:u,YoutubeImage:i,InternalPageTitle:c,UnAuthenticatedBlock:m,AuthenticatedBlock:d}=n;return d||s("AuthenticatedBlock",!0),t||s("InternalPageMenu",!0),u||s("InternalPageMenuItem",!0),c||s("InternalPageTitle",!0),a||s("PathViewer",!0),o||s("PathViewerItem",!0),m||s("UnAuthenticatedBlock",!0),i||s("YoutubeImage",!0),r.createElement(r.Fragment,null,r.createElement(n.h1,null,"c) Authentification & utilisation d'op√©rations prot√©g√©es par JWT au sein d'une IHM"),"\n",r.createElement(t,null,r.createElement(a,null,r.createElement(o,{to:"/"}," web2course "),r.createElement(o,{to:"/part4"}," Partie 4 "),r.createElement(o,{selected:!0}," c) HMI & JWT ")),r.createElement(u,null," Authentification d'un utilisateur via une IHM & JWT "),r.createElement(u,null," Autorisation de l'appel √† une op√©ration prot√©g√©e "),r.createElement(u,null," Mise en place du localStorage pour sauvegarder les donn√©es de session  "),r.createElement(u,null," Projet 4.3 : Authentification et appel d'op√©rations prot√©g√©es par JWT "),r.createElement(u,null," üç¨ Persistance de donn√©es de session via des cookies ")),"\n",r.createElement("div",{className:"card card__simple-youtube-container"},r.createElement(i,{src:"https://youtu.be/YiPNns3GUGE"})),"\n",r.createElement(n.h1,null,r.createElement(c,null," Authentification d'un utilisateur via une IHM & JWT ")),"\n",r.createElement(n.p,null,"Pour authentifier un utilisateur via une IHM, il suffit de faire une requ√™te √† une RESTful API."),"\n",r.createElement(n.p,null,"G√©n√©ralement, l'utilisateur devra d'abord cr√©er son compte. Il utilisera un formulaire demandant au minimum un identifiant (username, adresse e-mail ou autres) et un password.",r.createElement(n.br),"\n","Dans le cadre d'une SPA, l'IHM fera appel √† une op√©ration de type ",r.createElement(n.strong,null,"register")," lorsque l'utilisateur soumet le formulaire."),"\n",r.createElement(n.p,null,"Par la suite, lorsque le compte de l'utilisateur existe, l'IHM fera appel √† une op√©ration de type ",r.createElement(n.strong,null,"login")," lorsque l'utilisateur tentera de se connecter √† l'aide d'un formulaire."),"\n",r.createElement(n.p,null,"Dans les deux cas, ",r.createElement(n.strong,null,"register")," ou ",r.createElement(n.strong,null,"login"),", le d√©veloppeur devra conna√Ætre les op√©rations mises √† disposition par l'API."),"\n",r.createElement(n.p,null,"Dans le cadre du site de la pizzeria, nous savons que l'API met √† disposition ces deux op√©rations :"),"\n",r.createElement(n.table,null,r.createElement(n.thead,null,r.createElement(n.tr,null,r.createElement(n.th,null,"URI"),r.createElement(n.th,null,"M√©thode HTTP"),r.createElement(n.th,null,"Op√©ration"))),r.createElement(n.tbody,null,r.createElement(n.tr,null,r.createElement(n.td,null,r.createElement(n.strong,null,r.createElement(n.code,null,"auths/login"))),r.createElement(n.td,null,r.createElement(n.strong,null,"POST")),r.createElement(n.td,null,'V√©rifier les credentials d\'une ressource de type "users" et renvoyer le username et un token JWT si les credentials sont OK')),r.createElement(n.tr,null,r.createElement(n.td,null,r.createElement(n.strong,null,r.createElement(n.code,null,"auths/register"))),r.createElement(n.td,null,r.createElement(n.strong,null,"POST")),r.createElement(n.td,null,'Cr√©er une ressource de type "users" et renvoyer le username et un token JWT')))),"\n",r.createElement("br"),"\n",r.createElement(n.p,null,"Pour ce nouveau tutoriel, nous allons continuer le d√©veloppement de l'IHM ",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/async-await"},"async-await-hmi")," (",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/async-await")),") pour que le formulaire de register et de login fassent appelle √† l'API et sauve temporairement le token renvoy√©."),"\n",r.createElement(n.p,null,"Au sein de votre repo ",r.createElement(n.strong,null,r.createElement(n.code,null,"web2")),", veuillez cr√©er le projet nomm√© ",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/jwt-fetch"))," sur base d'un copi√©/coll√© de ",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/async-await"))," (ou ",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/basic-fetch"},"async-await-hmi"),")."),"\n",r.createElement(n.p,null,"Veuillez d√©marrer la version ",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/api/safe"))," de la RESTful API de la pizzeria. En cas de souci, vous pouvez utiliser ce code-ci :\n",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/safe"},"api-safe"),"."),"\n",r.createElement(n.p,null,"Pour la suite du tutoriel, nous consid√©rons que tous les chemins absolus d√©marrent du r√©pertoire\n",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/jwt-fetch")),"."),"\n",r.createElement(n.p,null,"Veuillez mettre √† jour le code de la ",r.createElement(n.strong,null,r.createElement(n.code,null,"RegisterPage"))," afin de faire appel √† la m√©thode ",r.createElement(n.strong,null,r.createElement(n.code,null,"POST /auths/register"))," et, si tout est OK, rediriger l'utilisateur vers la ",r.createElement(n.strong,null,r.createElement(n.code,null,"HomePage"))," via la fonction ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navigate"))," :"),"\n",r.createElement(n.pre,{numbered:!0,highlighting:"2,34-63"},r.createElement(n.code,{className:"language-js"},"import { clearPage, renderPageTitle } from '../../utils/render';\nimport Navigate from '../Router/Navigate';\n\nconst RegisterPage = () => {\n  clearPage();\n  renderPageTitle('Register');\n  renderRegisterForm();\n};\n\nfunction renderRegisterForm() {\n  const main = document.querySelector('main');\n  const form = document.createElement('form');\n  form.className = 'p-5';\n  const username = document.createElement('input');\n  username.type = 'text';\n  username.id = 'username';\n  username.placeholder = 'username';\n  username.required = true;\n  username.className = 'form-control mb-3';\n  const password = document.createElement('input');\n  password.type = 'password';\n  password.id = 'password';\n  password.required = true;\n  password.placeholder = 'password';\n  password.className = 'form-control mb-3';\n  const submit = document.createElement('input');\n  submit.value = 'Register';\n  submit.type = 'submit';\n  submit.className = 'btn btn-danger';\n  form.appendChild(username);\n  form.appendChild(password);\n  form.appendChild(submit);\n  main.appendChild(form);\n  form.addEventListener('submit', onRegister);\n}\n\nasync function onRegister(e) {\n  e.preventDefault();\n\n  const username = document.querySelector('#username').value;\n  const password = document.querySelector('#password').value;\n\n  const options = {\n    method: 'POST',\n    body: JSON.stringify({\n      username,\n      password,\n    }),\n    headers: {\n      'Content-Type': 'application/json',\n    },\n  };\n\n  const response = await fetch('/api/auths/register', options);\n\n  if (!response.ok) throw new Error(`fetch error : ${response.status} : ${response.statusText}`);\n\n  const authenticatedUser = await response.json();\n\n  console.log('Newly registered & authenticated user : ', authenticatedUser);\n\n  Navigate('/');\n}\n\nexport default RegisterPage;\n\n")),"\n",r.createElement(n.p,null,"Veuillez ex√©cuter le frontend et vous assurer que l'utilisateur que vous tentez de cr√©er est bien cr√©√© par votre API. Si tout fonctionne, vous aurez une confirmation dans la console de votre browser."),"\n",r.createElement(n.p,null,"Bien, nous souhaitons pour l'instant sauvegarder ",r.createElement(n.strong,null,r.createElement(n.code,null,"authenticatedUser"))," de mani√®re temporaire, car cet objet contient comme info le username et le token de l'utilisateur."),"\n",r.createElement(n.p,null,"üí≠ Comment faire pour que cet objet soit disponible dans d'autres modules ?\nCette question nous permet d'explorer un propri√©t√© importante des ",r.createElement(n.strong,null,r.createElement(n.code,null,"export"))," d'objets via ECMAScript : ce sont des objets immuables, c'est-√†-dire dont vous ne pouvez pas directement changer leurs valeurs. Comment faire alors pour offrir ",r.createElement(n.strong,null,r.createElement(n.code,null,"authenticatedUser"))," ?",r.createElement(n.br),"\n","Nous allons offrir quatre nouvelles fonctions :"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"une fonction qui renverra l'√©tat de la variable ",r.createElement(n.strong,null,r.createElement(n.code,null,"authenticatedUser"))," ;"),"\n",r.createElement(n.li,null,"une fonction qui permettra de modifier la variable ",r.createElement(n.strong,null,r.createElement(n.code,null,"authenticatedUser"))," ;"),"\n",r.createElement(n.li,null,"une fonction qui indiquera si l'utilisateur est authentifi√© ou pas ;"),"\n",r.createElement(n.li,null,"une fonction qui permettra de faire un reset de l'utilisateur en cours (on utilisera cette fonction lors d'un logout)."),"\n"),"\n",r.createElement(n.p,null,"Veuillez cr√©er le fichier ",r.createElement(n.strong,null,r.createElement(n.code,null,"/src/utils/auths.js"))," et y ajouter le code suivant :"),"\n",r.createElement(n.pre,{numbered:!0},r.createElement(n.code,{className:"language-js"},"let currentUser;\n\nconst getAuthenticatedUser = () => currentUser;\n\nconst setAuthenticatedUser = (authenticatedUser) => {\n  currentUser = authenticatedUser;\n};\n\nconst isAuthenticated = () => currentUser !== undefined;\n\nconst clearAuthenticatedUser = () => {\n  currentUser = undefined;\n};\n\n// eslint-disable-next-line object-curly-newline\nexport { getAuthenticatedUser, setAuthenticatedUser, isAuthenticated, clearAuthenticatedUser };\n")),"\n",r.createElement(n.p,null,"Veuillez mettre √† jour le code de la ",r.createElement(n.strong,null,r.createElement(n.code,null,"RegisterPage"))," afin de sauver en m√©moire vive l'utilisateur authentifi√©. Nous allons aussi pr√©parer la suite afin d'avoir une ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," qui s'adaptera lorsqu'un utilisateur est authentifi√©, c'est pourquoi nous allons appeler le composant ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," :"),"\n",r.createElement(n.pre,{numbered:!0,highlighting:"1,3,66,68"},r.createElement(n.code,{className:"language-js"},"import { setAuthenticatedUser } from '../../utils/auths';\nimport { clearPage, renderPageTitle } from '../../utils/render';\nimport Navbar from '../Navbar/Navbar';\nimport Navigate from '../Router/Navigate';\n\nconst RegisterPage = () => {\n  clearPage();\n  renderPageTitle('Register');\n  renderRegisterForm();\n};\n\nfunction renderRegisterForm() {\n  const main = document.querySelector('main');\n  const form = document.createElement('form');\n  form.className = 'p-5';\n  const username = document.createElement('input');\n  username.type = 'text';\n  username.id = 'username';\n  username.placeholder = 'username';\n  username.required = true;\n  username.className = 'form-control mb-3';\n  const password = document.createElement('input');\n  password.type = 'password';\n  password.id = 'password';\n  password.required = true;\n  password.placeholder = 'password';\n  password.className = 'form-control mb-3';\n  const submit = document.createElement('input');\n  submit.value = 'Register';\n  submit.type = 'submit';\n  submit.className = 'btn btn-danger';\n  form.appendChild(username);\n  form.appendChild(password);\n  form.appendChild(submit);\n  main.appendChild(form);\n  form.addEventListener('submit', onRegister);\n}\n\nasync function onRegister(e) {\n  e.preventDefault();\n\n  const username = document.querySelector('#username').value;\n  const password = document.querySelector('#password').value;\n\n  const options = {\n    method: 'POST',\n    body: JSON.stringify({\n      username,\n      password,\n    }),\n    headers: {\n      'Content-Type': 'application/json',\n    },\n  };\n\n  const response = await fetch('/api/auths/register', options);\n\n  if (!response.ok) throw new Error(`fetch error : ${response.status} : ${response.statusText}`);\n\n  const authenticatedUser = await response.json();\n\n  console.log('Newly registered & authenticated user : ', authenticatedUser);\n\n  setAuthenticatedUser(authenticatedUser);\n\n  Navbar();\n\n  Navigate('/');\n}\n\nexport default RegisterPage;\n")),"\n",r.createElement(n.p,null,"Pour la ",r.createElement(n.strong,null,r.createElement(n.code,null,"LoginPage")),", les modifications √† faire sont les m√™mes :"),"\n",r.createElement(n.pre,{numbered:!0,highlighting:"1,3-4,36-69"},r.createElement(n.code,{className:"language-js"},"import { setAuthenticatedUser } from '../../utils/auths';\nimport { clearPage, renderPageTitle } from '../../utils/render';\nimport Navbar from '../Navbar/Navbar';\nimport Navigate from '../Router/Navigate';\n\nconst LoginPage = () => {\n  clearPage();\n  renderPageTitle('Login');\n  renderRegisterForm();\n};\n\nfunction renderRegisterForm() {\n  const main = document.querySelector('main');\n  const form = document.createElement('form');\n  form.className = 'p-5';\n  const username = document.createElement('input');\n  username.type = 'text';\n  username.id = 'username';\n  username.placeholder = 'username';\n  username.required = true;\n  username.className = 'form-control mb-3';\n  const password = document.createElement('input');\n  password.type = 'password';\n  password.id = 'password';\n  password.required = true;\n  password.placeholder = 'password';\n  password.className = 'form-control mb-3';\n  const submit = document.createElement('input');\n  submit.value = 'Login';\n  submit.type = 'submit';\n  submit.className = 'btn btn-danger';\n  form.appendChild(username);\n  form.appendChild(password);\n  form.appendChild(submit);\n  main.appendChild(form);\n  form.addEventListener('submit', onLogin);\n}\n\nasync function onLogin(e) {\n  e.preventDefault();\n\n  const username = document.querySelector('#username').value;\n  const password = document.querySelector('#password').value;\n\n  const options = {\n    method: 'POST',\n    body: JSON.stringify({\n      username,\n      password,\n    }),\n    headers: {\n      'Content-Type': 'application/json',\n    },\n  };\n\n  const response = await fetch('/api/auths/login', options);\n\n  if (!response.ok) throw new Error(`fetch error : ${response.status} : ${response.statusText}`);\n\n  const authenticatedUser = await response.json();\n\n  console.log('Authenticated user : ', authenticatedUser);\n\n  setAuthenticatedUser(authenticatedUser);\n\n  Navbar();\n\n  Navigate('/');\n}\n\nexport default LoginPage;\n")),"\n",r.createElement(n.p,null,"Nous souhaitons maintenant faire en sorte que la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," affiche des √©l√©ments diff√©rents si l'utilisateur est authentifi√© ou pas :"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"s'il est authentifi√© : on affiche ",r.createElement(n.strong,null,r.createElement(n.code,null,"Home")),", ",r.createElement(n.strong,null,r.createElement(n.code,null,"Login")),", ",r.createElement(n.strong,null,r.createElement(n.code,null,"Register"))," et le ",r.createElement(n.strong,null,r.createElement(n.code,null,"username"))," de l'utilisateur connect√©."),"\n",r.createElement(n.li,null,"s'il est anonyme : on affiche ",r.createElement(n.strong,null,r.createElement(n.code,null,"Home")),", ",r.createElement(n.strong,null,r.createElement(n.code,null,"Add a pizza")),", ",r.createElement(n.strong,null,r.createElement(n.code,null,"Logout")),"."),"\n"),"\n",r.createElement(n.p,null,"Nous allons mettre √† jour la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," pour s'adapter √† l'authentification d'un utilisateur :"),"\n",r.createElement(n.pre,null,r.createElement(n.code,{className:"language-js"},'// eslint-disable-next-line no-unused-vars\nimport { Navbar as BootstrapNavbar } from \'bootstrap\';\nimport { getAuthenticatedUser, isAuthenticated } from \'../../utils/auths\';\n\nconst Navbar = () => {\n  renderNavbar();\n};\n\nfunction renderNavbar() {\n  const authenticatedUser = getAuthenticatedUser();\n\n  const anonymousUserNavbar = `\n<nav class="navbar navbar-expand-lg navbar-light bg-danger">\n      <div class="container-fluid">\n        <a class="navbar-brand" href="#">e-Pizzeria</a>\n        <button\n          class="navbar-toggler"\n          type="button"\n          data-bs-toggle="collapse"\n          data-bs-target="#navbarSupportedContent"\n          aria-controls="navbarSupportedContent"\n          aria-expanded="false"\n          aria-label="Toggle navigation"\n        >\n          <span class="navbar-toggler-icon"></span>\n        </button>\n        <div class="collapse navbar-collapse" id="navbarSupportedContent">\n          <ul class="navbar-nav me-auto mb-2 mb-lg-0">\n            <li class="nav-item">\n              <a class="nav-link active" aria-current="page" href="#" data-uri="/">Home</a>\n            </li>\n            <li id="loginItem" class="nav-item">\n              <a class="nav-link" href="#" data-uri="/login">Login</a>\n            </li>\n            <li id="registerItem" class="nav-item">\n              <a class="nav-link" href="#" data-uri="/register">Register</a>\n            </li>            \n          </ul>\n        </div>\n      </div>\n    </nav>\n`;\n\n  const authenticatedUserNavbar = `\n<nav class="navbar navbar-expand-lg navbar-light bg-danger">\n      <div class="container-fluid">\n        <a class="navbar-brand" href="#">e-Pizzeria</a>\n        <button\n          class="navbar-toggler"\n          type="button"\n          data-bs-toggle="collapse"\n          data-bs-target="#navbarSupportedContent"\n          aria-controls="navbarSupportedContent"\n          aria-expanded="false"\n          aria-label="Toggle navigation"\n        >\n          <span class="navbar-toggler-icon"></span>\n        </button>\n        <div class="collapse navbar-collapse" id="navbarSupportedContent">\n          <ul class="navbar-nav me-auto mb-2 mb-lg-0">\n            <li class="nav-item">\n              <a class="nav-link active" aria-current="page" href="#" data-uri="/">Home</a>\n            </li>          \n            <li class="nav-item">\n              <a class="nav-link" href="#" data-uri="/add-pizza">Add a pizza</a>\n            </li>\n            <li class="nav-item">\n              <a class="nav-link" href="#" data-uri="/logout">Logout</a>\n            </li>    \n            <li class="nav-item">\n              <a class="nav-link disabled" href="#">${authenticatedUser?.username}</a>\n            </li>           \n          </ul>\n        </div>\n      </div>\n    </nav>\n`;\n\n  const navbar = document.querySelector(\'#navbarWrapper\');\n\n  navbar.innerHTML = isAuthenticated() ? authenticatedUserNavbar : anonymousUserNavbar;\n}\n\nexport default Navbar;\n')),"\n",r.createElement(n.p,null,"Ce code est quasi enti√®rement neuf. On a rajout√© l'√©l√©ment qui permettra de r√©aliser le logout d'un utilisateur. Avant d'aller plus loin, veuillez tester l'application.",r.createElement(n.br),"\n","Loguez-vous avec l'utilisateur ",r.createElement(n.strong,null,r.createElement(n.code,null,"admin"))," (et le password ",r.createElement(n.strong,null,r.createElement(n.code,null,"admin")),") et v√©rifiez que vous √™tes bien redirig√© vers la ",r.createElement(n.strong,null,r.createElement(n.code,null,"HomePage"))," une fois authentifi√©, que la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," contient bien les √©l√©ments attendus, dont le ",r.createElement(n.strong,null,r.createElement(n.code,null,"username")),".",r.createElement(n.br),"\n","Veuillez maintenant tester un clic sur l'√©l√©ment ",r.createElement(n.strong,null,r.createElement(n.code,null,"Add a pizza"))," de la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar")),". Il ne se passe rien..."),"\n",r.createElement(n.p,null,"üí≠ Pourquoi les clics ne sont plus pris en compte ?",r.createElement(n.br),"\n","En fait, regardons le code de notre ",r.createElement(n.strong,null,r.createElement(n.code,null,"Router")),", pour la gestion des clics sur la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," :"),"\n",r.createElement(n.pre,null,r.createElement(n.code,{className:"language-js"},"function onNavBarClick() {\n  const navItems = document.querySelectorAll('.nav-link');\n\n  navItems.forEach((item) => {\n    item.addEventListener('click', (e) => {\n      e.preventDefault();\n      const uri = e.target?.dataset?.uri;\n      const componentToRender = routes[uri];\n      if (!componentToRender) throw Error(`The ${uri} ressource does not exist.`);\n\n      componentToRender();\n      window.history.pushState({}, '', uri);\n    });\n  });\n}\n")),"\n",r.createElement(n.p,null,"Tant dans ",r.createElement(n.strong,null,r.createElement(n.code,null,"LoginPage"))," que dans ",r.createElement(n.strong,null,r.createElement(n.code,null,"RegisterPage")),", nous faisons appel √† la fonction ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar")),' qui fait un "rerender" (r√©affichage) de la ',r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar")),'. Ainsi, tous les √©l√©ments de la barre de navigation sont "rerender", et donc comme le ',r.createElement(n.strong,null,r.createElement(n.code,null,"Router"))," n'est pas r√©appel√©, la fonction ",r.createElement(n.strong,null,r.createElement(n.code,null,"onNavBarClick"))," n'est pas r√©ex√©cut√©e. Ainsi, m√™me si les nouveaux √©l√©ments de la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," ont la classe CSS ",r.createElement(n.strong,null,r.createElement(n.code,null,"nav-link")),", leurs √©couteurs d'√©v√©nements de type ",r.createElement(n.strong,null,r.createElement(n.code,null,"click"))," n'existent plus."),"\n",r.createElement(n.p,null,"üí≠ Comment corriger cela ?",r.createElement(n.br),"\n","On pourrait se dire qu'il suffit de faire appel √† la fonction ",r.createElement(n.strong,null,r.createElement(n.code,null,"onNavBarClick"))," dans la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar")),". Cette solution ne fonctionnerait pas car nous aurions des d√©pendances cycliques, la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," devrait faire appel aux routes, qui elles font appel aux pages, les pages faisant appel √† la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar")),"...",r.createElement(n.br),"\n","D√®s lors, le mieux serait de mettre un √©couteur d'√©v√©nements au niveau du wrapper de la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar")),".",r.createElement(n.br),"\n","Comme le wrapper n'est jamais r√©initialis√©, tout sera en ordre.",r.createElement(n.br),"\n","Veuillez donc mettre √† jour la fonction ",r.createElement(n.strong,null,r.createElement(n.code,null,"onNavBarClick"))," de ",r.createElement(n.strong,null,r.createElement(n.code,null,"/src/Components/Router/Router.js"))," :"),"\n",r.createElement(n.pre,{highlighting:"2,4,6-8"},r.createElement(n.code,{className:"language-js"},"function onNavBarClick() {\n  const navbarWrapper = document.querySelector('#navbarWrapper');\n\n  navbarWrapper.addEventListener('click', (e) => {\n    e.preventDefault();\n    const navBarItemClicked = e.target;\n    const uri = navBarItemClicked?.dataset?.uri;\n    if (uri) {\n      const componentToRender = routes[uri];\n      if (!componentToRender) throw Error(`The ${uri} ressource does not exist.`);\n\n      componentToRender();\n      window.history.pushState({}, '', uri);\n    }\n  });\n}\n")),"\n",r.createElement(n.p,null,"Veuillez noter que le ",r.createElement(n.strong,null,r.createElement(n.code,null,"navbarWrapper"))," est initialis√© au sein du composant ",r.createElement(n.strong,null,r.createElement(n.code,null,"Header")),".",r.createElement(n.br),"\n","Dans la nouvelle version du code du ",r.createElement(n.strong,null,r.createElement(n.code,null,"Router")),", le gestionnaire de clics est ajout√© au niveau de ce wrapper. Gr√¢ce √† l'event objet ",r.createElement(n.strong,null,r.createElement(n.code,null,"e")),", on acc√®de √† l'√©l√©ment sur lequel on a cliqu√© gr√¢ce √† la propri√©t√© ",r.createElement(n.strong,null,r.createElement(n.code,null,"target")),". On retrouve donc l'√©l√©ment de la navbar sur lequel on a cliqu√© tr√®s facilement."),"\n",r.createElement(n.p,null,"Veuillez tester votre IHM et v√©rifier qu'une fois logu√©, vous puissiez bien voyager entre les pages."),"\n",r.createElement(n.p,null,"Il reste maintenant √† cr√©er un composant permettant de faire un logout. On souhaite que ce composant de logout supprime l'utilisateur authentifi√©, r√©affiche la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," pour un utilisateur anonyme et redirige l'utilisateur vers la page de login."),"\n",r.createElement(n.p,null,"Pour ce faire, veuillez cr√©er le dossier et le fichier ",r.createElement(n.strong,null,r.createElement(n.code,null,"/src/Components/Logout/Logout.js"))," et y ajouter ce code :"),"\n",r.createElement(n.pre,null,r.createElement(n.code,{className:"language-js"},"import { clearAuthenticatedUser } from '../../utils/auths';\nimport Navbar from '../Navbar/Navbar';\nimport Navigate from '../Router/Navigate';\n\nconst Logout = () => {\n  clearAuthenticatedUser();\n  Navbar();\n  Navigate('/login');\n};\n\nexport default Logout;\n")),"\n",r.createElement(n.p,null,"Attention, m√™me si nous avons mis √† jour la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," et cr√©√© le composant ",r.createElement(n.strong,null,r.createElement(n.code,null,"Logout")),", le boilerplate du frontend impose de rajouter une route au sein du ",r.createElement(n.strong,null,r.createElement(n.code,null,"Router"))," pour qu'un clic sur l'√©l√©ment ",r.createElement(n.strong,null,r.createElement(n.code,null,"Logout"))," de la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," am√®ne √† appeler le composant ",r.createElement(n.strong,null,r.createElement(n.code,null,"Logout")),".\nVeuillez donc mettre √† jour ",r.createElement(n.strong,null,r.createElement(n.code,null,"routes"))," au sein de ",r.createElement(n.strong,null,r.createElement(n.code,null,"/src/Components/Router/Router.js"))," :"),"\n",r.createElement(n.pre,{highlighting:"1,12"},r.createElement(n.code,{className:"language-js"},"import Logout from '../Logout/Logout';\nimport AddPizzaPage from '../Pages/AddPizzaPage';\nimport HomePage from '../Pages/HomePage';\nimport LoginPage from '../Pages/LoginPage';\nimport RegisterPage from '../Pages/RegisterPage';\n\nconst routes = {\n  '/': HomePage,\n  '/login': LoginPage,\n  '/register': RegisterPage,\n  '/add-pizza': AddPizzaPage,\n  '/logout': Logout,\n};\n")),"\n",r.createElement(n.p,null,"Veuillez maintenant tester le login et le logout. Tout devrait √™tre fonctionnel !",r.createElement(n.br),"\n","Il nous reste √† faire en sorte que l'on puisse autoriser l'op√©ration de cr√©ation de pizza."),"\n",r.createElement(n.h1,null,r.createElement(c,null," Autorisation de l'appel √† une op√©ration prot√©g√©e  ")),"\n",r.createElement(n.p,null,"Nous allons maintenant voir comment, √† partir d'une IHM, nous pouvons utiliser un token pour acc√©der √† une op√©ration d'une RESTful API."),"\n",r.createElement(n.p,null,"Veuillez vous assurer que la version ",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/api/safe"))," de la RESTful API de la pizzeria est bien d√©marr√©e. En cas de souci, vous pouvez utiliser ce code-ci :\n",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/safe"},"api-safe"),"."),"\n",r.createElement(n.p,null,"Veuillez vous connecter √† l'IHM du tutoriel en cours (",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/jwt-fetch")),") √† l'aide du compte ",r.createElement(n.strong,null,r.createElement(n.code,null,"manager"))," et tentez d'ajouter une pizza. Cela ne devrait pas fonctionner."),"\n",r.createElement(n.p,null,'Veuillez regarder dans la console : il devrait y avoir une erreur qui s\'affiche avec le "status code" ',r.createElement(n.strong,null,r.createElement(n.code,null,"401 : Unauthorized")),".",r.createElement(n.br),"\n","En effet, l'API attend un token pour autoriser l'op√©ration de cr√©ation d'une pizza."),"\n",r.createElement(n.p,null,"Nous allons donc mettre √† jour ",r.createElement(n.strong,null,r.createElement(n.code,null,"/src/Components/Pages/AddPizzaPage.js"))," pour ajouter le token de l'utilisateur authentifi√© au sein du header de la requ√™te (il n'y a que trois lignes √† rajouter) :"),"\n",r.createElement(n.pre,{numbered:!0,highlighting:"1,44,54"},r.createElement(n.code,{className:"language-js"},"import { getAuthenticatedUser } from '../../utils/auths';\nimport { clearPage, renderPageTitle } from '../../utils/render';\nimport Navigate from '../Router/Navigate';\n\nconst AddPizzaPage = () => {\n  clearPage();\n  renderPageTitle('Add a pizza to the menu');\n  renderAddPizzaForm();\n};\n\nfunction renderAddPizzaForm() {\n  const main = document.querySelector('main');\n  const form = document.createElement('form');\n  form.className = 'p-5';\n  const title = document.createElement('input');\n  title.type = 'text';\n  title.id = 'title';\n  title.placeholder = 'title of your pizza';\n  title.required = true;\n  title.className = 'form-control mb-3';\n  const content = document.createElement('input');\n  content.type = 'text';\n  content.id = 'content';\n  content.required = true;\n  content.placeholder = 'Content of your pizza';\n  content.className = 'form-control mb-3';\n  const submit = document.createElement('input');\n  submit.value = 'Add pizza to the menu';\n  submit.type = 'submit';\n  submit.className = 'btn btn-danger';\n  form.appendChild(title);\n  form.appendChild(content);\n  form.appendChild(submit);\n  main.appendChild(form);\n  form.addEventListener('submit', onAddPizza);\n}\n\nasync function onAddPizza(e) {\n  e.preventDefault();\n\n  const title = document.querySelector('#title').value;\n  const content = document.querySelector('#content').value;\n\n  const authenticatedUser = getAuthenticatedUser();\n\n  const options = {\n    method: 'POST',\n    body: JSON.stringify({\n      title,\n      content,\n    }),\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: authenticatedUser.token,\n    },\n  };\n\n  const response = await fetch('/api/pizzas', options);\n\n  if (!response.ok) throw new Error(`fetch error : ${response.status} : ${response.statusText}`);\n\n  const newPizza = await response.json();\n\n  console.log('New pizza added : ', newPizza);\n\n  Navigate('/');\n}\n\nexport default AddPizzaPage;\n\n")),"\n",r.createElement(n.p,null,"Veuillez vous connecter √† l'IHM √† l'aide du compte ",r.createElement(n.strong,null,r.createElement(n.code,null,"manager"))," et tenter d'ajouter une pizza. Cela ne devrait toujours pas fonctionner. Veuillez regarder dans la console : il devrait y avoir une erreur qui s'affiche avec le \"status code\" ",r.createElement(n.strong,null,r.createElement(n.code,null,"403 : Forbidden")),".",r.createElement(n.br),"\n","En effet, l'API attend un token pour autoriser l'op√©ration de cr√©ation d'une pizza, mais seulement ",r.createElement(n.strong,null,r.createElement(n.code,null,"admin"))," a le privil√®ge d'ajouter une pizza au menu !"),"\n",r.createElement(n.p,null,"D√©connectez-vous (logout), reconnectez-vous √† l'aide du compte ",r.createElement(n.strong,null,r.createElement(n.code,null,"admin")),", et ajoutez une pizza.\nVoila ! Le site devrait √™tre enti√®rement fonctionnel !"),"\n",r.createElement(n.p,null,"Si tout fonctionne bien, faites un ",r.createElement(n.strong,null,r.createElement(n.code,null,"commit"))," de votre repo (",r.createElement(n.strong,null,r.createElement(n.code,null,"web2")),") avec comme message : ",r.createElement(n.strong,null,r.createElement(n.code,null,"jwt-fetch-hmi tutorial")),"."),"\n",r.createElement(n.p,null,"En cas de souci, vous pouvez utiliser le code du tutoriel :"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"pour le frontend : ",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/jwt-fetch"},"jwt-fetch-hmi"),"."),"\n",r.createElement(n.li,null,"pour l'API : ",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/safe"},"api-safe"),"."),"\n"),"\n",r.createElement(n.p,null,'üí≠ Est-ce que c\'est "safe" que notre IHM affiche le menu "Add a pizza" pour un utilisateur qui n\'est pas l\'admin ?',r.createElement(n.br),"\n",r.createElement(n.em,null,"En fait oui, c'est \"safe\", vous l'avez test√©. L'API ne doit jamais faire confiance aux applications clientes pour appliquer la s√©curit√©. Ainsi, m√™me si le frontend autorise l'acc√®s √† des op√©rations qui ne devraient pas √™tre permises, au regard des autorisations appliqu√©es par l'API, √ßa n'a pas d'importance point de vue s√©curit√©.",r.createElement(n.br),"\n","De la m√™me fa√ßon, c'est pour √ßa qu'une API doit aussi toujours valider les param√®tres qu'elle re√ßoit. Elle ne peut pas faire confiance aux applications clientes, comme par exemple √† une application web tournant dans un browser, pour valider tous les champs d'un formulaire.",r.createElement(n.br),"\n","La raison est simple, l'API est d√©velopp√©e ind√©pendamment des applications clientes, elle ne peut pas supposer que les requ√™tes seront toujours bien construites.")),"\n",r.createElement(n.p,null,"üí≠ OK, tout est \"safe\" si l'API fait toutes les v√©rifications n√©cessaires. N√©anmoins, n'y a-t-il pas des r√®gles de bonnes pratiques au niveau des IHM, pour ne pas permettre de faire n'importe quelles requ√™tes vers des API ?",r.createElement(n.br),"\n",r.createElement(n.em,null,"Et bien oui, au niveau des IHM, pour des questions d'",r.createElement(n.strong,null,"ergonomie"),", d'exp√©rience utilisateur, on va faire en sorte :")),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,r.createElement(n.em,null,"de ne pas offrir des op√©rations qui ne seront pas autoris√©es. Par exemple, dans le cadre de ce tutoriel sur un site permettant de g√©rer une pizzeria, il ne faut pas \"frustrer\" les utilisateurs en leur faisant croire qu'ils ont acc√®s √† l'op√©ration de cr√©er une pizza ! Imaginez-vous, vous cr√©ez une nouvelle pizza de 32 ingr√©dients, et lors de la soumission, vous recevez un message comme quoi vous n'√™tes pas l'admin du site et que vous n'avez donc pas le droit de cr√©er une pizza üò≤!")),"\n",r.createElement(n.li,null,r.createElement(n.em,null,"de ne pas demander du travail √† une API quand l'IHM peut d√©tecter que ce n'est pas utile.\nAinsi, quand une IHM offre des formulaires, qui am√®neront √† des requ√™tes vers des API, on √©vitera d'autoriser la soumission des donn√©es tant que les champs n'ont pas √©t√© valid√©s. Tout ce que l'IHM peut valider c√¥t√© client, elle doit le faire. Le feedback sera plus rapide pour l'utilisateur, et les ressources de l'API seront √©conomis√©es (pas d'appel inutile).")),"\n"),"\n",r.createElement(n.p,null,"N'h√©sitez donc pas √† mettre √† jour ce tutoriel pour faire en sorte de n'afficher \"Add a pizza\" que si l'utilisateur est ",r.createElement(n.strong,null,r.createElement(n.code,null,"admin")),"."),"\n",r.createElement(n.p,null,"üí≠ Ca n'est pas un peu \"cheap\" que seul l'utilisateur ",r.createElement(n.strong,null,r.createElement(n.code,null,"admin"))," puisse avoir le privil√®ge d'administrateur du site ?",r.createElement(n.br),"\n",r.createElement(n.em,null,"H√© bien oui, c'est \"cheap\". G√©n√©ralement, dans le cadre d'applications plus robustes, nous allons ajouter un ou plusieurs r√¥le(s) aux utilisateurs. Par exemple, dans le cadre d'applications o√π les r√¥les sont simples, qu'il n'y a jamais qu'un seul r√¥le associ√© √† un utilisateur, il suffirait d'ajouter au niveau de l'API la propri√©t√© ",r.createElement(n.strong,null,r.createElement(n.code,null,"role"))," aux utilisateurs. La majorit√© des utilisateurs pourrait avoir un r√¥le dont la valeur serait ",r.createElement(n.strong,null,r.createElement(n.code,null,"default")),", et une minorit√© d'utilisateur auraient le r√¥le d'",r.createElement(n.strong,null,r.createElement(n.code,null,"admin")),"...")),"\n",r.createElement(n.p,null,"On n'affiche actuellement ",r.createElement(n.strong,null,"pas de message d'erreur")," √† l'utilisateur lorsque la r√©ponse d'une API renvoie une erreur. Pour am√©liorer l'exp√©rience de l'utilisateur, ce serait une am√©lioration √† faire."),"\n",r.createElement(n.p,null,"Finalement, lorsqu'on ferme le browser et revient sur l'application par la suite, on n'est plus authentifi√©. Nous allons donc prochainement voir comment nous pourrions sauvegarder des donn√©es de session (le token et le username) c√¥t√©-client, dans le browser."),"\n",r.createElement(n.h1,null,r.createElement(c,null," Mise en place du localStorage pour sauvegarder les donn√©es de session ")),"\n",r.createElement(n.p,null,"Dans le cadre du site nous permettant de g√©rer une pizzeria, nous allons faire en sorte de sauvegarder les donn√©es de session au sein du ",r.createElement(n.strong,null,r.createElement(n.code,null,"localStorage")),", et plus juste en m√©moire vive. Nous allons appliquer ce que nous avons appris dans la partie sur ",r.createElement(n.a,{href:"../../part2/sessions/"},"Les sessions c√¥t√© client"),"."),"\n",r.createElement(n.p,null,"Veuillez d√©marrer la version ",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/api/safe"))," de la RESTful API de la pizzeria. En cas de souci, vous pouvez utiliser ce code-ci :\n",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/safe"},"api-safe"),"."),"\n",r.createElement(n.p,null,"Pour ce nouveau tutoriel, au sein de votre repo ",r.createElement(n.strong,null,r.createElement(n.code,null,"web2")),", veuillez cr√©er le projet nomm√© ",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/web-storage"))," sur base d'un copier/coller de ",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/jwt-fetch"))," (ou ",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/jwt-fetch"},"jwt-fetch-hmi"),")."),"\n",r.createElement(n.p,null,"Pour la suite du tutoriel, nous consid√©rons que tous les chemins absolus d√©marrent du r√©pertoire\n",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/web-storage")),"."),"\n",r.createElement(n.p,null,"Afin de sauvegarder les donn√©es de session, c'est √† dire l'objet ",r.createElement(n.strong,null,r.createElement(n.code,null,"authenticatedUser"))," contenant un token et un username, nous devons juste mettre √† jour le fichier ",r.createElement(n.strong,null,r.createElement(n.code,null,"/usr/utils/auths.js"))," :"),"\n",r.createElement(n.pre,{numbered:!0,highlighting:"1,7,10,15-16,24"},r.createElement(n.code,{className:"language-js"},"const STORE_NAME = 'user';\nlet currentUser;\n\nconst getAuthenticatedUser = () => {\n  if (currentUser !== undefined) return currentUser;\n\n  const serializedUser = localStorage.getItem(STORE_NAME);\n  if (!serializedUser) return undefined;\n\n  currentUser = JSON.parse(serializedUser);\n  return currentUser;\n};\n\nconst setAuthenticatedUser = (authenticatedUser) => {\n  const serializedUser = JSON.stringify(authenticatedUser);\n  localStorage.setItem(STORE_NAME, serializedUser);\n\n  currentUser = authenticatedUser;\n};\n\nconst isAuthenticated = () => currentUser !== undefined;\n\nconst clearAuthenticatedUser = () => {\n  localStorage.removeItem(STORE_NAME);\n  currentUser = undefined;\n};\n\n// eslint-disable-next-line object-curly-newline\nexport { getAuthenticatedUser, setAuthenticatedUser, isAuthenticated, clearAuthenticatedUser };\n")),"\n",r.createElement(n.p,null,"Au sein de ",r.createElement(n.strong,null,r.createElement(n.code,null,"getAuthenticatedUser"))," :"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"on fait un premier check afin d'√©viter d'aller lire dans le ",r.createElement(n.strong,null,r.createElement(n.code,null,"localStorage"))," si la variable ",r.createElement(n.strong,null,r.createElement(n.code,null,"currentUser"))," est d√©j√† initialis√©e."),"\n",r.createElement(n.li,null,"on parse l'utilisateur authentifi√© et s√©rialis√© qui est retrouv√© dans le ",r.createElement(n.strong,null,r.createElement(n.code,null,"localStorage"))," via la cl√© ",r.createElement(n.strong,null,r.createElement(n.code,null,"STORE_NAME")),"."),"\n"),"\n",r.createElement(n.p,null,"Au sein de ",r.createElement(n.strong,null,r.createElement(n.code,null,"setAuthenticatedUser")),", on s√©rialise ",r.createElement(n.strong,null,r.createElement(n.code,null,"authenticatedUser"))," avant d'ajouter une paire cl√©/valeur au ",r.createElement(n.strong,null,r.createElement(n.code,null,"localStorage")),".  Ces donn√©es restent dans le browser, peu importe le nombre de fois que l'on red√©marre son browser."),"\n",r.createElement(n.p,null,"Dans ",r.createElement(n.strong,null,r.createElement(n.code,null,"clearAuthenticatedUser")),", on efface la paire cl√©/valeur associ√©e √† l'utilisateur authentifi√© (via la cl√© ",r.createElement(n.strong,null,r.createElement(n.code,null,"STORE_NAME")),")."),"\n",r.createElement(n.p,null,"Veuillez bien mettre √† jour votre code et tester l'application.",r.createElement(n.br),"\n","Connectez-vous √† l'aide de l'utilisateur ",r.createElement(n.strong,null,r.createElement(n.code,null,"manager")),".  Veuillez fermer votre browser.",r.createElement(n.br),"\n","Veuillez le r√©ouvrir.",r.createElement(n.br),"\n","Vous devriez automatiquement √™tre authentifi√© : veuillez observer l'√©tat de la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," pour vous en assurer."),"\n",r.createElement(n.p,null,"üí≠ O√π puis-je observer l'√©tat des donn√©es sauvegard√©es dans le web storage de mon browser ?",r.createElement(n.br),"\n","Tout en ayant la fen√™tre de votre application ouverte, via Chrome, allez dans vos outils de d√©veloppeurs : ",r.createElement(n.strong,null,r.createElement(n.code,null,"F12")),".",r.createElement(n.br),"\n","Puis, dans l'onglet ",r.createElement(n.strong,null,r.createElement(n.code,null,"Application")),", vous trouverez dans ",r.createElement(n.strong,null,r.createElement(n.code,null,"Storage"))," : ",r.createElement(n.strong,null,r.createElement(n.code,null,"Local Storage"))," et ",r.createElement(n.strong,null,r.createElement(n.code,null,"Session Storage")),".",r.createElement(n.br),"\n","Ici, nous utilisons le ",r.createElement(n.strong,null,r.createElement(n.code,null,"Local Storage")),", donc cliquez dessus, vous verrez appara√Ætre ",r.createElement(n.strong,null,r.createElement(n.code,null,"http://localhost:8080")),". Cliquez sur cette URL, et vous verrez vos donn√©es de session, quelque chose du style ",r.createElement(n.strong,null,r.createElement(n.code,null,'{"username":"manager","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Im1hbmFnZXIiLCJpYXQiOjE2NjE3NjM3MDksImV4cCI6MTc0ODE2MzcwOX0.jAxH0WsOgiK5vf4QduDZ8JgTR-SKC42G9aPieV_OTOo"}')),".",r.createElement(n.br),"\n","N'h√©sitez pas √† faire un clic droit sur l'URL ",r.createElement(n.strong,null,r.createElement(n.code,null,"http://localhost:8080")),", puis ",r.createElement(n.strong,null,r.createElement(n.code,null,"Clear")),".",r.createElement(n.br),"\n","Si vous faites ensuite un refresh de votre page, comme votre session aura √©t√© effac√©e, votre utilisateur ne sera plus connect√©. Votre ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," affichera le menu pour un utilisateur anonyme !",r.createElement(n.br),"\n","Faites ce test, c'est int√©ressant üòâ."),"\n",r.createElement(n.p,null,"Si tout fonctionne bien, faites un ",r.createElement(n.strong,null,r.createElement(n.code,null,"commit"))," de votre repo (",r.createElement(n.strong,null,r.createElement(n.code,null,"web2")),") avec comme message :\n",r.createElement(n.strong,null,r.createElement(n.code,null,"web-storage-hmi tutorial")),"."),"\n",r.createElement(n.p,null,"En cas de souci, vous pouvez utiliser le code du tutoriel :"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"pour le frontend : ",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/web-storage"},"web-storage-hmi"),"."),"\n",r.createElement(n.li,null,"pour l'API : ",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/safe"},"api-safe"),"."),"\n"),"\n",r.createElement(n.h1,null,r.createElement(c,null," Projet 4.3 : Authentification et appel d'op√©rations prot√©g√©es par JWT ")),"\n",r.createElement(n.h2,null,"Mise en place du projet"),"\n",r.createElement(n.p,null,"Vous devez mettre √† jour votre frontend afin qu'il consomme les nouvelles op√©rations de votre API qui ont √©t√© d√©velopp√©es pour ",r.createElement(n.a,{href:"../security-api/#projet_4_2_securisation_d_api"},"Projet 4.2"),"."),"\n",r.createElement(n.p,null,"Le code de votre frontend doit se trouver dans votre repository local et votre web repository (normalement appel√© ",r.createElement(n.strong,null,r.createElement(n.code,null,"web2")),") dans le r√©pertoire nomm√© ",r.createElement(n.strong,null,r.createElement(n.code,null,"/project/4.3/hmi"))," sur base d'un copier/coller du code de ",r.createElement(n.a,{href:"../../part3/#projet_3_1_deploiement_de_votre_frontend_de_votre_backend"},"Projet 3.1"),"."),"\n",r.createElement(n.h2,null,"Authentification et appel d'op√©rations n√©cessitant une autorisation JWT"),"\n",r.createElement(n.p,null,"M√™me si votre projet ne n√©cessite pas d'authentification, afin d'apprendre les concepts associ√©s √† \"JWT auths\", veuillez cr√©er un prototype de frontend introduisant ces cas d'utilisation :"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,r.createElement(n.strong,null,r.createElement(n.code,null,"register"))," : les utilisateurs doivent pouvoir cr√©er un compte."),"\n",r.createElement(n.li,null,r.createElement(n.strong,null,r.createElement(n.code,null,"login"))," : les utilisateur doivent pouvoir se loguer."),"\n",r.createElement(n.li,null,r.createElement(n.strong,null,r.createElement(n.code,null,"logout"))," : les utilisateurs doivent pouvoir se d√©connecter."),"\n"),"\n",r.createElement(m,null,r.createElement(n.p,null,"Si vous avez choisi comme projet d'approfondir le d√©veloppement de l'application ",r.createElement(n.strong,null,r.createElement(n.code,null,"myMovies")),", celle-ci doit maintenant autoriser les op√©rations suivantes que pour des utilisateurs authentifi√©s :"),r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"UC2 : l'ajout d'une ressource de type films via un formulaire d'ajout d'un film."),"\n",r.createElement(n.li,null,"UC3 : la suppression d'un film."),"\n",r.createElement(n.li,null,"UC4 : la mise √† jour des donn√©es d'un film (√† l'exception de l'id associ√© √† un film)."),"\n"),r.createElement(n.p,null,"Comme auparavant, cette op√©ration est permise pour tous les utilisateurs, anonymes ou authentifi√©s :"),r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"UC1 : l'affichage, sous forme de tableau, de toutes les ressources de type films."),"\n")),"\n",r.createElement(n.p,null,"Pensez √† bien mettre √† jour votre ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," pour afficher les bons menus en fonction que l'utilisateur est authentifi√© ou pas."),"\n",r.createElement(n.p,null,"Faites attention, il n'est pas autoris√©, pour des raisons d'ergonomie, que le frontend offre les fonctionnalit√©s d'√©criture de ressources pour les utilisateur non authentifi√©s. Vous devez donc rendre invisible les op√©rations non autoris√©es aux utilisateurs."),"\n",r.createElement(m,null,r.createElement(n.p,null,"UC2 (create), UC3 (delete) et UC4 (update) doivent √™tre invisibles pour les utilisateurs anonymes.")),"\n",r.createElement(n.p,null,"Dans un premier temps, veuillez faire en sorte de rajouter dans le web storage ces nouvelles donn√©es de session lors du login ou du register : le token et le username.",r.createElement(n.br),"\n","NB : pr√©c√©demment vous aviez des donn√©es de session √† g√©rer pour le th√®me et pour un message concernant le respect de la vie priv√©e."),"\n",r.createElement(d,null,r.createElement(n.p,null,"Veuillez travailler avec les membres de votre groupe et vous partager le travail :"),r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"certains membres peuvent travailler sur le frontend ;"),"\n",r.createElement(n.li,null,"d'autres membres peuvent travailler sur le backend s'il vous reste des op√©rations √† rajouter."),"\n"),r.createElement(n.p,null,"Un peu avant la fin de la s√©ance, veuillez discuter :"),r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"pr√©senter ce que vous avez appris au niveau de la s√©curisation aux membres qui ont travaill√© sur autre chose."),"\n")),"\n",r.createElement(n.p,null,"Quand votre prototype de frontend offre l'authentification (register & login) et utilise toutes les op√©rations s√©curis√©es de votre API, que les sessions sont bien sauvegard√©es, veuillez faire un ",r.createElement(n.strong,null,r.createElement(n.code,null,"commit"))," de votre code avec comme message : ",r.createElement(n.strong,null,r.createElement(n.code,null,"4.3.1 : hmi jwt auths")),"."),"\n",r.createElement(n.h4,null,"ü§ù Tips"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"N'h√©sitez pas √† copier/coller les fichiers utiles trouv√©s dans le tutoriel associ√© √† cette partie : ",r.createElement(n.strong,null,r.createElement(n.code,null,"RegisterPage")),", ",r.createElement(n.strong,null,r.createElement(n.code,null,"LoginPage")),", ",r.createElement(n.strong,null,r.createElement(n.code,null,"Logout")),", ",r.createElement(n.strong,null,r.createElement(n.code,null,"auths")),", ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," (diff√©rent affichage pour un utilisateur anonyme que pour un utilisateur connect√©)...."),"\n",r.createElement(n.li,null,"Attention √† ne pas oublier de mettre √† jour votre ",r.createElement(n.strong,null,r.createElement(n.code,null,"Router"))," : nouvelles pages pour le register, le login et le logout, la Navbar..."),"\n",r.createElement(n.li,null,"Ajoutez les tokens dans le header de vos requ√™tes ",r.createElement(n.strong,null,r.createElement(n.code,null,"fetch")),"..."),"\n",r.createElement(n.li,null,"Concernant le ",r.createElement(n.strong,null,r.createElement(n.code,null,"Router")),", il faut mettre √† jour ",r.createElement(n.strong,null,r.createElement(n.code,null,"onNavBarClick"))," pour que les gestionnaires d'ev√©n√©ments restent attach√©s m√™me quand la ",r.createElement(n.strong,null,r.createElement(n.code,null,"Navbar"))," est r√©affich√©e."),"\n",r.createElement(n.li,null,"üí≠ Comment rendre invisible les op√©rations d'√©criture de certaines ressources au sein du frontend ?",r.createElement(n.br),"\n","Par exemple, vous pourriez afficher des boutons de type ",r.createElement(n.strong,null,r.createElement(n.code,null,"Delete"))," ou ",r.createElement(n.strong,null,r.createElement(n.code,null,"Save"))," que si l'utilisateur est authentifi√©.",r.createElement(n.br),"\n","De m√™me, si l'utilisateur est anonyme, les ressources ne devraient pas √™tre √©ditables."),"\n"),"\n",r.createElement(n.h2,null,"üç¨ Gestion de session & remember me"),"\n",r.createElement(n.p,null,'Vous pourriez ajouter une fonction "remember me" √† votre formulaire de "login" et de "register" et faire en sorte que vos donn√©es de session soient sauvegard√©es :'),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"dans le ",r.createElement(n.strong,null,r.createElement(n.code,null,"localStorage")),' si l\'on clique sur une checkbox "Remember me" ;'),"\n",r.createElement(n.li,null,"dans le ",r.createElement(n.strong,null,r.createElement(n.code,null,"sessionStorage")),' si l\'on ne clique pas sur la checkbox "Remember me" lors du login ou du register.'),"\n"),"\n",r.createElement(n.p,null,"Quand votre prototype de frontend est finalis√©, veuillez faire un ",r.createElement(n.strong,null,r.createElement(n.code,null,"commit"))," de votre code avec comme message : ",r.createElement(n.strong,null,r.createElement(n.code,null,"4.3.2 : remember me")),"."),"\n",r.createElement(n.h4,null,"ü§ù Tips"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"Vous allez pouvoir refaire un peu de gestion d'√©v√©nements pour d√©tecter les clics sur une checkbox. N'h√©sitez pas √† voir ce que propose ",r.createElement(n.strong,null,"Bootstrap 5")," pour les ",r.createElement(n.strong,null,"checkboxes"),"."),"\n",r.createElement(n.li,null,"Prenez un moment pour voir comment g√©rer la persistance de l'info 'Remember me'...",r.createElement(n.br),"\n","Est-ce que ce n'est pas une donn√©e de session qui doit persister lorsque l'utilisateur ferme son browser ?",r.createElement(n.br),"\n","En effet, point de vue ergonomie, il est int√©ressant que le dernier choix de l'utilisateur soit toujours pr√©sent√©. La checkbox devrait donc rester ",r.createElement(n.strong,null,r.createElement(n.code,null,"checked"))," ou pas, tant que l'utilisateur ne change pas son √©tat, via un clic, ou via un Logout ; et cet √©tat doit subsister aux travers des connexions (ouvertures / fermetures du browser)."),"\n"),"\n",r.createElement(n.h1,null,r.createElement(c,null," üç¨ Persistance de donn√©es de session via des cookies ")),"\n",r.createElement(n.h2,null,"Authentification & autorisation JWT √† l'aide de cookies"),"\n",r.createElement(n.p,null,"Dans la partie optionnelle sur l'",r.createElement(n.a,{href:"../security-api/#%F0%9F%8D%AC_authentification_autorisation_jwt_a_laide_de_cookies"},"Authentification & autorisation JWT √† l'aide de cookies"),", nous avons vu comment mettre √† jour l'API afin d'int√©grer les tokens JWT aux cookies."),"\n",r.createElement(n.p,null,"Veuillez d√©marrer la version ",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/api/cookies"))," de la RESTful API de la pizzeria. En cas de souci, vous pouvez utiliser ce code-ci :\n",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/cookies"},"api-cookies"),"."),"\n",r.createElement(n.p,null,"Nous allons voir maintenant comment le frontend peut utiliser ces cookies."),"\n",r.createElement(n.h2,null,"Gestion de session c√¥t√© client via une IHM et des cookies"),"\n",r.createElement(n.p,null,"Pour ce nouveau tutoriel, nous allons repartir de la derni√®re version de notre frontend."),"\n",r.createElement(n.p,null,"Au sein de votre repo ",r.createElement(n.strong,null,r.createElement(n.code,null,"web2")),", veuillez cr√©er le projet nomm√© ",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/cookies"))," sur base d'un copi√©/coll√© de ",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/web-storage"))," (ou ",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/web-storage"},"web-storage-hmi"),")."),"\n",r.createElement(n.p,null,"Pour la suite du tutoriel, nous consid√©rons que tous les chemins absolus d√©marrent du r√©pertoire\n",r.createElement(n.strong,null,r.createElement(n.code,null,"/web2/tutorials/pizzeria/hmi/cookies")),"."),"\n",r.createElement(n.p,null,"Afin de sauvegarder les donn√©es de session, c'est √† dire l'objet ",r.createElement(n.strong,null,r.createElement(n.code,null,"authenticatedUser"))," contenant juste un username, nous ne devons m√™me pas mettre √† jour le fichier ",r.createElement(n.strong,null,r.createElement(n.code,null,"/usr/utils/auths.js")),". En effet, l'API ",r.createElement(n.strong,null,r.createElement(n.code,null,"cookies"))," renvoie un objet du genre ",r.createElement(n.strong,null,r.createElement(n.code,null,'{username: "manager"}')),". Au niveau de l'IHM, le code est donc toujours fonctionnel pour sauvegarder le username gr√¢ce √† ",r.createElement(n.code,null,"authenticatedUser"),"."),"\n",r.createElement(n.p,null,"Il ne reste donc qu'√† changer le code o√π nous avons besoin d'une autorisation. Pour l'application de gestion de la pizzeria, il s'agit de la cr√©ation de pizza.",r.createElement(n.br),"\n","Veuillez donc mettre √† jour ",r.createElement(n.strong,null,r.createElement(n.code,null,"/src/Components/AddPizzaPage.js"))," en enlevant ces deux lignes :"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"l'authenticatedUser : ",r.createElement(n.strong,null,r.createElement(n.code,null,"const authenticatedUser = getAuthenticatedUser();"))," et l'import associ√© (",r.createElement(n.strong,null,r.createElement(n.code,null,"import { getAuthenticatedUser } from '../../utils/auths';")),"),"),"\n",r.createElement(n.li,null,"la ligne s'occupant de l'authorization header : ",r.createElement(n.strong,null,r.createElement(n.code,null,"Authorization: authenticatedUser.token")),"."),"\n"),"\n",r.createElement(n.p,null,"Veuillez tester votre derni√®re version du frontend.\nLoguez-vous avec l'utilisateur ",r.createElement(n.strong,null,r.createElement(n.code,null,"admin"))," (et le password ",r.createElement(n.strong,null,r.createElement(n.code,null,"admin")),").",r.createElement(n.br),"\n","Ajoutez une pizza et v√©rifiez qu'elle s'affiche bien."),"\n",r.createElement(n.p,null,"üí≠ Comment v√©rifier le cookie ?",r.createElement(n.br),"\n","Tout en ayant la fen√™tre de votre application ouverte, via Chrome, allez dans vos outils de d√©veloppeurs : ",r.createElement(n.strong,null,r.createElement(n.code,null,"F12")),".",r.createElement(n.br),"\n","Puis, dans l'onglet ",r.createElement(n.strong,null,r.createElement(n.code,null,"Application")),", cliquez sur ",r.createElement(n.strong,null,r.createElement(n.code,null,"Cookies")),", vous verrez appara√Ætre ",r.createElement(n.strong,null,r.createElement(n.code,null,"http://localhost:8080")),". Cliquez sur cette URL, et vous verrez vos 2 cookies de session, ",r.createElement(n.strong,null,r.createElement(n.code,null,"user.sig"))," et ",r.createElement(n.strong,null,r.createElement(n.code,null,"user")),".",r.createElement(n.br),"\n","N'h√©sitez pas √† aller d√©coder la valeur du cookie ",r.createElement(n.strong,null,r.createElement(n.code,null,"user"))," sur ",r.createElement(n.a,{href:"https://www.base64decode.org/"},"base64decode")," en faisant un copier / coller de ",r.createElement(n.strong,null,r.createElement(n.code,null,"Value")),". Vous devriez voir quelque chose appara√Ætre du style ",r.createElement(n.strong,null,r.createElement(n.code,null,'{"username":"manager","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Im1hbmFnZXIiLCJpYXQiOjE2NjE3NzUxMDgsImV4cCI6MTc0ODE3NTEwOH0.sAZqq6vbrjCCZZoLH-n8hJKBoXJJJ8jEoupk8xKu5WI"}')),"  !"),"\n",r.createElement(n.p,null,"Toujours dans l'onglet ",r.createElement(n.strong,null,r.createElement(n.code,null,"Application"))," des outils de d√©veloppeurs de Chrome, faites un clear des cookies : clic droit sur ",r.createElement(n.strong,null,r.createElement(n.code,null,"http://localhost:8080")),", ",r.createElement(n.strong,null,r.createElement(n.code,null,"Clear")),".",r.createElement(n.br),"\n","Tentez maintenant d'ajouter une pizza... Ca ne fonctionne plus, et c'est bien normal, car il n'y a plus de token qui est envoy√© √† l'API !"),"\n",r.createElement(n.p,null,"Suite √† ces tests, si tout fonctionne bien, faites un ",r.createElement(n.strong,null,r.createElement(n.code,null,"commit"))," de votre repo (",r.createElement(n.strong,null,r.createElement(n.code,null,"web2")),") avec comme message : ",r.createElement(n.strong,null,r.createElement(n.code,null,"cookies-hmi tutorial")),"."),"\n",r.createElement(n.p,null,"En cas de souci, vous pouvez utiliser le code du tutoriel :"),"\n",r.createElement(n.ul,null,"\n",r.createElement(n.li,null,"pour le frontend : ",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/cookies"},"cookies-hmi"),"."),"\n",r.createElement(n.li,null,"pour l'API : ",r.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/cookies"},"api-cookies"),"."),"\n"),"\n",r.createElement(n.p,null,"üí≠ Notons que cette version de notre frontend pourrait √™tre am√©lior√©e. Actuellement, lorsqu'on fait un logout, on n'efface pas le cookie du browser.",r.createElement(n.br),"\n","Comment feriez vous ?",r.createElement(n.br),"\n",r.createElement(n.em,null,"Vous pourriez par exemple appeler la m√©thode ",r.createElement(n.strong,null,r.createElement(n.code,null,"GET /auths/logout"))," üòâ.")))}var o=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,l.ah)(),e.components);return n?r.createElement(n,e,r.createElement(a,e)):a(e)};function s(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}var u=t(4160),i=t(5583),c=t(5679),m=t(307),d=t(7410),p=t(9523),E=t(8075),g=t(9063),v=t(1631),f=t(5772),h=t(2770),b=t(7008),z=t(9771),P=t(1218),w=(t(5258),t(9394)),j=t(4579),q=t(7743),N=t(9256),A=t(6488),y=t(5175),I=t(6387),k=t(6044);const U={Link:u.Link,Image:c.Z,Section:m.Z,Content:d.Z,Background:p.Z,SectionHeader:E.Z,SectionFooter:g.Z,PageHeader:v.Z,CodeBlock:h.Z,LinkFile:b.Z,ScrollableImage:z.Z,PublicProjectsView:P.Z,AuthenticatedBlock:w.Z,UnAuthenticatedBlock:j.Z,NestedMdxBlock:q.Z,YoutubeImage:N.Z,InternalPageMenu:A.Z,InternalPageMenuItem:y.Z,InternalPageTitle:I.Z,PathViewer:k.k,PathViewerItem:k.F};function C(e){var n,t,a,o,s;let{data:{mdx:u,allImages:c},children:m}=e;return U.PageHeader=(0,f.u)(v.Z,null==u?void 0:u.frontmatter),r.createElement(i.Z,Object.assign({},null!=u&&u.frontmatter?{frontmatter:u.frontmatter}:{},null!=u&&null!==(n=u.frontmatter)&&void 0!==n&&n.navbarExtraStyles?{navbarExtraStyles:u.frontmatter.navbarExtraStyles}:{},null!=u&&null!==(t=u.frontmatter)&&void 0!==t&&t.headerImage?{headerImage:u.frontmatter.headerImage}:{},null!=u&&null!==(a=u.frontmatter)&&void 0!==a&&a.featuredImage?{featuredImage:u.frontmatter.featuredImage}:{},null!=u&&null!==(o=u.frontmatter)&&void 0!==o&&o.title?{pageTitle:u.frontmatter.title}:{},c&&c.length>0?{allImages:c}:{}),r.createElement(l.Zo,{components:U},r.createElement("div",{className:null!=u&&null!==(s=u.frontmatter)&&void 0!==s&&s.autoMargin?"page page--auto-margin ":"page"},m)))}function S(e){return r.createElement(C,e,r.createElement(o,e))}}}]);
//# sourceMappingURL=component---src-templates-mdx-pages-js-content-file-path-src-mdx-pages-part-4-auths-hmi-fr-mdx-2cdc87f30a383e47e6fb.js.map