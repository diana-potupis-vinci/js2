{"version":3,"file":"component---src-templates-mdx-pages-js-content-file-path-src-mdx-pages-part-4-security-api-fr-mdx-7c82db16a25cf8a44463.js","mappings":"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","sources":["webpack://myjscourse/./src/mdx-pages/part4/security-api.fr.mdx","webpack://myjscourse/./src/templates/mdx-pages.js"],"sourcesContent":["/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\",\n    p: \"p\",\n    br: \"br\",\n    h2: \"h2\",\n    strong: \"strong\",\n    code: \"code\",\n    a: \"a\",\n    pre: \"pre\",\n    em: \"em\",\n    ul: \"ul\",\n    li: \"li\",\n    h4: \"h4\",\n    h3: \"h3\",\n    ol: \"ol\"\n  }, _provideComponents(), props.components), {InternalPageMenu, PathViewer, PathViewerItem, InternalPageMenuItem, InternalPageTitle, ScrollableImage, AuthenticatedBlock} = _components;\n  if (!AuthenticatedBlock) _missingMdxReference(\"AuthenticatedBlock\", true);\n  if (!InternalPageMenu) _missingMdxReference(\"InternalPageMenu\", true);\n  if (!InternalPageMenuItem) _missingMdxReference(\"InternalPageMenuItem\", true);\n  if (!InternalPageTitle) _missingMdxReference(\"InternalPageTitle\", true);\n  if (!PathViewer) _missingMdxReference(\"PathViewer\", true);\n  if (!PathViewerItem) _missingMdxReference(\"PathViewerItem\", true);\n  if (!ScrollableImage) _missingMdxReference(\"ScrollableImage\", true);\n  return React.createElement(React.Fragment, null, React.createElement(InternalPageMenu, null, React.createElement(PathViewer, null, React.createElement(PathViewerItem, {\n    to: \"/\"\n  }, \" web2course \"), React.createElement(PathViewerItem, {\n    to: \"/part4\"\n  }, \" Partie 4 \"), React.createElement(PathViewerItem, {\n    selected: true\n  }, \" b) Sécuritsation d'une RESTful API \")), React.createElement(InternalPageMenuItem, null, \" Protection contre les attaques XSS \"), React.createElement(InternalPageMenuItem, null, \" Sécurisation des passwords \"), React.createElement(InternalPageMenuItem, null, \" Projet 4.2 : Sécurisation d'API \"), React.createElement(InternalPageMenuItem, null, \" 🍬 Authentification & autorisation JWT à l'aide de cookies \")), \"\\n\", React.createElement(_components.h1, null, \"b) Sécurisation d'une RESTful API\"), \"\\n\", React.createElement(_components.p, null, \"La sécurisation d'API est une problématique complexe.\", React.createElement(_components.br), \"\\n\", \"Nous n'allons pas aller dans les détails de cette problématique, juste offrir une solution à deux cas simples à traiter.\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" Protection contre les attaques XSS \")), \"\\n\", React.createElement(_components.h2, null, \"Une attaque XSS, c'est quoi ?\"), \"\\n\", React.createElement(_components.p, null, \"Les attaques \", React.createElement(_components.strong, null, \"XSS\"), \", ou \", React.createElement(_components.strong, null, \"Cross-Site Scripting\"), \", sont un type d'injection de scripts malicieux dans une application web.\"), \"\\n\", React.createElement(_components.p, null, \"Imaginez le forum web d'une banque et ce scénario :\"), \"\\n\", React.createElement(ScrollableImage, {\n    name: \"xss.png\",\n    minWidth: \"500px\",\n    maxWidth: \"700px\"\n  }), \"\\n\", React.createElement(_components.p, null, \"L'API de la banque permet d'enregistrer des messages qui sont associés à des forums sur lesquels leurs clients peuvent poster des messages.\", React.createElement(_components.br), \"\\n\", \"Si l'API de la banque était mal sécurisée et qu'elle permettait d'enregistrer n'importe quels types d'information en tant que \\\"messages\\\" du forum, il serait possible à un attaquant d'injecter du JS malicieux dans l'API.\", React.createElement(_components.br), \"\\n\", \"Plus tard, lors de l'affichage des messages par le forum de la banque (\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"https://forum.my-bank.com\")), \"), le JS malicieux pourrait s'exécuter dans le browser de n'importe quel utilisateur.\", React.createElement(_components.br), \"\\n\", \"Vous avez vu que via du JS, on peut envoyer de l'information n'importe où, notamment à l'aide de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"fetch\")), \". Ce qui permettrait donc à un hacker, via son script malicieux, d'envoyer des cookies contenant des infos sensibles à son API malicieuse, en vue de futures attaques encore plus diaboliques, comme notamment vider le compte en banque d'utilisateurs.\"), \"\\n\", React.createElement(_components.p, null, \"La protection contre des attaques XSS se fait à différents niveaux. Ca n'est pas l'objet de ce cours de voir cela en détails, mais nous verrons un technique simple pour éviter certaines attaques.\"), \"\\n\", React.createElement(_components.h2, null, \"Réaliser une attaque XSS\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons maintenant réaliser une attaque XSS sur le site de la pizzeria.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez lancer le frontend \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/jwt-fetch\"\n  }, \"jwt-fetch-hmi\"), \" (nous allons le développer tout prochainement, vous pouvez simplement en faire une copie temporaire, l'installer et l'exécuter) et le backend \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"api-auths\")), \" du site de la pizzeria (\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/web2/tutorials/pizzeria/api/auths\")), \" ou en cas de soucis : \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/auths\"\n  }, \"api-auths\"), \").\"), \"\\n\", React.createElement(_components.p, null, \"Evidemment, un hackeur, pour tenter l'attaque XSS, doit d'abord trouver un moyen d'usurper la session d'\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"admin\")), \". Nous ne verrons pas dans ce cours le genre d'attaques qui permettrait de le faire. Nous allons considérer que cette première attaque est réussie et nous allons prendre le rôle d'un hackeur pouvant accéder au compte \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"admin\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez vous loguer à l'aide du compte \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"admin\")), \" (et le password \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"admin\")), \").\", React.createElement(_components.br), \"\\n\", \"Veuillez vous rendre sur la page \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Add a pizza\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Pour le titre de la pizza, vous pouvez ajouter n'importe quoi.\\r\\nDans le contenu de la pizza, veuillez ajouter cela et soumettre :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-text\"\n  }, \"<img src=\\\"#\\\" onerror=\\\"alert('You have been hacked !')\\\">\\n\")), \"\\n\", React.createElement(_components.p, null, \"En fait, nous avons ajouté une balise \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"img\")), \" contenant du inline JS. \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"onerror\")), \" est un gestionnaire d'événements qui sera d'office appelé car la source (\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"src=\\\"#\\\"\")), \" ) donné à \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"img\")), \" n'est pas une image.\"), \"\\n\", React.createElement(_components.p, null, \"Maintenant, tout utilisateur connecté ou pas qui se loguera sur le site va exécuter ce script \\\"malicieux\\\". Il verra le pop-up apparaître avec le message \", React.createElement(_components.em, null, \"\\\"You have been hacked !\\\"\"), \".\", React.createElement(_components.br), \"\\n\", \"En effet, le menu des pizzas, tel qu'il est construit, est basé sur toutes les ressources de type \\\"pizzas\\\" renvoyées par l'API, dont une des pizzas contient le JS malicieux qui est exécuté dans une cellule de la table via ce code de la \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"HomePage\")), \" de l'IHM :\"), \"\\n\", React.createElement(_components.pre, {\n    highlighting: \"7\"\n  }, React.createElement(_components.code, {\n    className: \"language-js\"\n  }, \"function getAllTableLinesAsString(menu) {\\r\\n  let pizzaTableLines = '';\\r\\n\\r\\n  menu?.forEach((pizza) => {\\r\\n    pizzaTableLines += `<tr>\\r\\n      <td>${pizza.title}</td>\\r\\n      <td>${pizza.content}</td>\\r\\n    </tr>`;\\r\\n  });\\r\\n\\r\\n  return pizzaTableLines;\\r\\n}\\n\")), \"\\n\", React.createElement(_components.h2, null, \"Empêcher les attaques XSS\"), \"\\n\", React.createElement(_components.p, null, \"Par rapport à l'attaque précédente, le plus simple pour protéger de l'attaque pourrait être de faire en sorte que l'application cliente n'interprète pas d'HTML / JS / CSS envoyé par l'API.\"), \"\\n\", React.createElement(_components.p, null, \"Ici, dans la \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"HomePage\")), \", on utilise la propriété \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"innerHTML\")), \" d'une \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"td\")), \". Ainsi, l'HTML et l'inline JS associé est exécuté. Si l'on utilisais la propriété \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"innerText\")), \" des \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"td\")), \", alors, ni l'HTML et le JS serait interprété par le browser, et donc pas de possibilité de script malicieux au niveau de la \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"HomePage\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Oui, mais si nous allions vers cette solution, cela serait problématique si nous souhaitions réellement développer plusieurs applications clientes, il faudrait toujours faire attention à cette contrainte.\"), \"\\n\", React.createElement(_components.p, null, \"Dès lors, nous allons préférer la solution où nous sécurisons l'API. Ainsi, peu importe l'application cliente développée, il devrait y avoir moins d'angles d'attaques.\"), \"\\n\", React.createElement(_components.p, null, \"Au niveau de l'API, nous allons échapper les caractères dangereux, principalement \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"\\\"\")), \", \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"'\")), \", \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"&\")), \", \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"<\")), \", \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \">\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons utiliser la librairie \", React.createElement(_components.strong, null, React.createElement(_components.a, {\n    href: \"https://www.npmjs.com/package/escape-html\"\n  }, \"escape-html\")), \" sous Node.js échappant les string pour une utilisation des string transformées en HTML.\"), \"\\n\", React.createElement(_components.p, null, \"Pour ce nouveau tutoriel, nous allons continuer le développement de l'API \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/auths\"\n  }, \"api-auths\"), \" et la sécuriser.\"), \"\\n\", React.createElement(_components.p, null, \"Au sein de votre repo \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"web2\")), \", veuillez créer le projet nommé \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/web2/tutorials/pizzeria/api/safe\")), \" sur base d'un copié/collé de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/web2/tutorials/pizzeria/api/auths\")), \" (ou \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/auths\"\n  }, \"api-auths\"), \").\"), \"\\n\", React.createElement(_components.p, null, \"Pour la suite du tutoriel, nous considérons que tous les chemins absolus démarrent du répertoire\\r\\n\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/web2/tutorials/pizzeria/api/safe\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez installer la librairie \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"escape-html\")), \" au sein de votre projet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"safe\")), \" :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-bash\"\n  }, \"npm i escape-html\\n\")), \"\\n\", React.createElement(_components.p, null, \"Nous allons supprimer, s'il existe, le fichier reprenant le code malicieux introduit précédemment : veuillez supprimer le fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/data/pizzas.json\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons mettre à jour le modèle de pizzas pour échapper les caractères dangereux.\\r\\nVeuillez modifier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/models/pizzas.js\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    highlighting: \"1,9-10\"\n  }, React.createElement(_components.code, {\n    className: \"language-js\"\n  }, \"const escape = require('escape-html');\\r\\n// other bits of code\\r\\n\\r\\nfunction createOnePizza(title, content) {\\r\\n  const pizzas = parse(jsonDbPath, defaultPizzas);\\r\\n\\r\\n  const createdPizza = {\\r\\n    id: getNextId(),\\r\\n    title: escape(title),\\r\\n    content: escape(content),\\r\\n  };\\r\\n\\r\\n  pizzas.push(createdPizza);\\r\\n\\r\\n  serialize(jsonDbPath, pizzas);\\r\\n\\r\\n  return createdPizza;\\r\\n}\\n\")), \"\\n\", React.createElement(_components.p, null, \"Nous allons maintenant tester si tout est réglé au niveau de l'attaque XSS.\", React.createElement(_components.br), \"\\n\", \"Dans votre frontend temporaire (\", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/jwt-fetch\"\n  }, \"jwt-fetch\"), \"), veuillez vous loguer à l'aide du compte \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"admin\")), \" (et le password \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"admin\")), \").\", React.createElement(_components.br), \"\\n\", \"Veuillez vous rendre sur la page \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Add a pizza\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Comme précédemment :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"Pour le titre de la pizza, vous pouvez ajouter n'importe quoi.\"), \"\\n\", React.createElement(_components.li, null, \"Dans le contenu de la pizza, veuillez ajouter cela et soumettre :\"), \"\\n\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-text\"\n  }, \"<img src=\\\"#\\\" onerror=\\\"alert('You have been hacked !')\\\">\\n\")), \"\\n\", React.createElement(_components.p, null, \"Maintenant, tout utilisateur connecté verra simplement apparaître, quand il affiche la \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"HomePage\")), \", le menu des pizzas avec :\"), \"\\n\", React.createElement(ScrollableImage, {\n    name: \"hacked.png\",\n    minWidth: \"500px\",\n    maxWidth: \"744px\"\n  }), \"\\n\", React.createElement(_components.p, null, \"Il n'y a plus de code JavaScript malicieux qui peut s'exécuter côté client 🎉 !\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons maintenant régler les problèmes de passwords mis en clair dans un fichier de l'API.\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" Sécurisation des passwords \")), \"\\n\", React.createElement(_components.p, null, \"Nous souhaitons maintenant assurer que les passwords enregistrés dans un support de données (un fichier ou une base de données) ne puissent pas être récupérés.\"), \"\\n\", React.createElement(_components.p, null, \"👍 Pour ce faire, il est recommandé d'hacher les passwords avant de les enregistrer au niveau d'une API.\"), \"\\n\", React.createElement(_components.p, null, \"Afin de se protéger contre les \\\"hash attacks\\\", on utilise du \", React.createElement(_components.strong, null, \"salt\"), \" :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"un \", React.createElement(_components.strong, null, \"salt\"), \" : c'est une donnée aléatoire qui est utilisé en entrée d'une fonction qui hache des données. Ainsi, si un hackeur utilise une base de données de passwords hachés, il devra en plus trouver le bon \", React.createElement(_components.strong, null, \"salt\"), \" pour que son attaque puisse fonctionner.\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"salt round\"), \" : nombre de fois que l'opération de hachage est faite, rendant les attaques de force brute plus lente et donc difficile ; une valeur de \", React.createElement(_components.strong, null, \"10\"), \" semble être généralement raisonnable et recommendée.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Pour hacher sous Node.js, nous utiliserons la librairie \", React.createElement(_components.a, {\n    href: \"https://www.npmjs.com/package/bcrypt\"\n  }, \"bcrypt\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez installer la librairie \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"bcrypt\")), \" au sein de votre API \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"safe\")), \" :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-bash\"\n  }, \"npm i bcrypt\\n\")), \"\\n\", React.createElement(_components.p, null, \"En résumé, nous allons utiliser :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"la fonction asynchrone \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"hash\")), \" de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"bcrypt\")), \" pour \", React.createElement(_components.strong, null, \"hacher un password\"), \" ;\"), \"\\n\", React.createElement(_components.li, null, \"la fonction asynchrone \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"compare\")), \" de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"bcrypt\")), \" pour \", React.createElement(_components.strong, null, \"comparer un password en clair à un password haché\"), \" ; si le résultat est positif, cela signifie que le password fournit pour un utilisateur correspond au password initial.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Nous préférons utiliser les librairies asynchrone afin que l'API reste disponible à gérer des requêtes clientes et ne bloque pas celles-ci jusqu'à la fin d'une opération de \", React.createElement(_components.strong, null, \"bcrypt\"), \" !\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez effacer le fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/data/users.json\")), \" contenant les credentials d'utilisateurs où les passwords sont donnés en clair.\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons maintenant mettre à jour le modèle de \\\"users\\\" pour utiliser \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"bcrypt\")), \". Veuillez modifier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/models/users.js\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"2,9,17,21,25-26,42,46,70,73\"\n  }, React.createElement(_components.code, {\n    className: \"language-js\"\n  }, \"const jwt = require('jsonwebtoken');\\r\\nconst bcrypt = require('bcrypt');\\r\\nconst path = require('node:path');\\r\\nconst { parse, serialize } = require('../utils/json');\\r\\n\\r\\nconst jwtSecret = 'ilovemypizza!';\\r\\nconst lifetimeJwt = 24 * 60 * 60 * 1000; // in ms : 24 * 60 * 60 * 1000 = 24h\\r\\n\\r\\nconst saltRounds = 10;\\r\\n\\r\\nconst jsonDbPath = path.join(__dirname, '/../data/users.json');\\r\\n\\r\\nconst defaultUsers = [\\r\\n  {\\r\\n    id: 1,\\r\\n    username: 'admin',\\r\\n    password: bcrypt.hashSync('admin', saltRounds),\\r\\n  },\\r\\n];\\r\\n\\r\\nasync function login(username, password) {\\r\\n  const userFound = readOneUserFromUsername(username);\\r\\n  if (!userFound) return undefined;\\r\\n\\r\\n  const passwordMatch = await bcrypt.compare(password, userFound.password);\\r\\n  if (!passwordMatch) return undefined;\\r\\n\\r\\n  const token = jwt.sign(\\r\\n    { username }, // session data added to the payload (payload : part 2 of a JWT)\\r\\n    jwtSecret, // secret used for the signature (signature part 3 of a JWT)\\r\\n    { expiresIn: lifetimeJwt }, // lifetime of the JWT (added to the JWT payload)\\r\\n  );\\r\\n\\r\\n  const authenticatedUser = {\\r\\n    username,\\r\\n    token,\\r\\n  };\\r\\n\\r\\n  return authenticatedUser;\\r\\n}\\r\\n\\r\\nasync function register(username, password) {\\r\\n  const userFound = readOneUserFromUsername(username);\\r\\n  if (userFound) return undefined;\\r\\n\\r\\n  await createOneUser(username, password);\\r\\n\\r\\n  const token = jwt.sign(\\r\\n    { username }, // session data added to the payload (payload : part 2 of a JWT)\\r\\n    jwtSecret, // secret used for the signature (signature part 3 of a JWT)\\r\\n    { expiresIn: lifetimeJwt }, // lifetime of the JWT (added to the JWT payload)\\r\\n  );\\r\\n\\r\\n  const authenticatedUser = {\\r\\n    username,\\r\\n    token,\\r\\n  };\\r\\n\\r\\n  return authenticatedUser;\\r\\n}\\r\\n\\r\\nfunction readOneUserFromUsername(username) {\\r\\n  const users = parse(jsonDbPath, defaultUsers);\\r\\n  const indexOfUserFound = users.findIndex((user) => user.username === username);\\r\\n  if (indexOfUserFound < 0) return undefined;\\r\\n\\r\\n  return users[indexOfUserFound];\\r\\n}\\r\\n\\r\\nasync function createOneUser(username, password) {\\r\\n  const users = parse(jsonDbPath, defaultUsers);\\r\\n\\r\\n  const hashedPassword = await bcrypt.hash(password, saltRounds);\\r\\n\\r\\n  const createdUser = {\\r\\n    id: getNextId(),\\r\\n    username,\\r\\n    password: hashedPassword,\\r\\n  };\\r\\n\\r\\n  users.push(createdUser);\\r\\n\\r\\n  serialize(jsonDbPath, users);\\r\\n\\r\\n  return createdUser;\\r\\n}\\r\\n\\r\\nfunction getNextId() {\\r\\n  const users = parse(jsonDbPath, defaultUsers);\\r\\n  const lastItemIndex = users?.length !== 0 ? users.length - 1 : undefined;\\r\\n  if (lastItemIndex === undefined) return 1;\\r\\n  const lastId = users[lastItemIndex]?.id;\\r\\n  const nextId = lastId + 1;\\r\\n  return nextId;\\r\\n}\\r\\n\\r\\nmodule.exports = {\\r\\n  login,\\r\\n  register,\\r\\n  readOneUserFromUsername,\\r\\n};\\n\")), \"\\n\", React.createElement(_components.p, null, \"Voici les modifications apportées :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"pour créer un password hashé\"), \" : on utilise la fonction asynchrone \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"hash\")), \" pour créer le password haché. Dès lors, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"createOneUser\")), \" devient asynchrone. De plus, comme \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"createOneUser\")), \" est devenue asynchrone, dans \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \", pour chaîner le traitement de création du token, on met un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"await\")), \" à l'appel de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"createOneUser\")), \". Et comme un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"await\")), \" est ajouté au sein de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \", il faut mettre un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"async\")), \" à la méthode \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \". Attention, du coup, comme \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" est devenue asynchrone, il faudra aussi bien chaîner les traitements où \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" est appelé, dans le router \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths\")), \".\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"pour vérifier qu'un password en clair \\\"match\\\" à un password haché\"), \" : on utilise la fonction asynchrone \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"compare\")), \" que l'on chaîne à la création du token à l'aide de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"await\")), \". Dès lors, la fonction \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" doit elle aussi être déclarée \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"async\")), \". Attention, du coup, comme \", React.createElement(_components.code, null, \"login\"), \" est devenue asynchrone, il faudra bien chaîner les traitements où \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" est appelé, dans le router \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"auths\")), \".\"), \"\\n\", React.createElement(_components.li, null, React.createElement(_components.strong, null, \"pour créer l'utilisateur \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"admin\")), \" se trouvant dans les \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"defaultUsers\")), \" avec des credentials par défaut\"), \" : on souhaite indiquer comme \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"password\")), \" le password haché correspondant au password \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"\\\"admin\\\"\")), \". Pour se simplifier la vie, on appelle la fonction synchrone \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"hashSync\")), \" (voir ligne 16). Bien évidemment, dans une application plus robuste, on évitera d'hardcoder ce genre de secrets dans les sources de notre application 😉 !\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Afin de traiter des deux fonctions du modèle \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"users\")), \" qui sont devenues asynchrones, \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \", nous allons modifier le router \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/routes/auths\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"7,13,21,27\"\n  }, React.createElement(_components.code, {\n    className: \"language-js\"\n  }, \"const express = require('express');\\r\\nconst { register, login } = require('../models/users');\\r\\n\\r\\nconst router = express.Router();\\r\\n\\r\\n/* Register a user */\\r\\nrouter.post('/register', async (req, res) => {\\r\\n  const username = req?.body?.username?.length !== 0 ? req.body.username : undefined;\\r\\n  const password = req?.body?.password?.length !== 0 ? req.body.password : undefined;\\r\\n\\r\\n  if (!username || !password) return res.sendStatus(400); // 400 Bad Request\\r\\n\\r\\n  const authenticatedUser = await register(username, password);\\r\\n\\r\\n  if (!authenticatedUser) return res.sendStatus(409); // 409 Conflict\\r\\n\\r\\n  return res.json(authenticatedUser);\\r\\n});\\r\\n\\r\\n/* Login a user */\\r\\nrouter.post('/login', async (req, res) => {\\r\\n  const username = req?.body?.username?.length !== 0 ? req.body.username : undefined;\\r\\n  const password = req?.body?.password?.length !== 0 ? req.body.password : undefined;\\r\\n\\r\\n  if (!username || !password) return res.sendStatus(400); // 400 Bad Reques\\r\\n\\r\\n  const authenticatedUser = await login(username, password);\\r\\n\\r\\n  if (!authenticatedUser) return res.sendStatus(401); // 401 Unauthorized\\r\\n\\r\\n  return res.json(authenticatedUser);\\r\\n});\\r\\n\\r\\nmodule.exports = router;\\n\")), \"\\n\", React.createElement(_components.p, null, \"Nous avons simplement chaîné les réponses à faire au client seulement une fois les opération \", React.createElement(_components.code, null, \"register\"), \"** et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" terminées. Pour ce faire, nous avons précédé le nom de ces méthodes par \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"await\")), \". Nous avons donc du ajouter \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"async\")), \" aux fonctions middleware s'occupant des routes \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"POST /auths/register\")), \" et \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"POST /auths/login\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez vérifier que votre application fonctionne correctement.\", React.createElement(_components.br), \"\\n\", \"Via l'IHM, veuillez faire un register d'un nouvel utilisateur.\", React.createElement(_components.br), \"\\n\", \"Au niveau de l'API, allez voir le contenu du nouveau fichier \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/data/users.json\")), \". Les passwords devraient maintenant être hachés, comme par exemple :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-json\"\n  }, \"[\\r\\n  {\\r\\n    \\\"id\\\": 1,\\r\\n    \\\"username\\\": \\\"admin\\\",\\r\\n    \\\"password\\\": \\\"$2b$10$RioLKlPFyYFEhv/46gR7dufDkke07eDpWH9tBt/A4Z9tJh0oJnnf2\\\"\\r\\n  },\\r\\n  {\\r\\n    \\\"id\\\": 2,\\r\\n    \\\"username\\\": \\\"manager\\\",\\r\\n    \\\"password\\\": \\\"$2b$10$NZZ1zxOPdby6gl4Dw8K0Q.v4ZRWTbh1Ta7qcYzH5G4SrO5z71H0kO\\\"\\r\\n  }\\r\\n]\\n\")), \"\\n\", React.createElement(_components.p, null, \"Si tout fonctionne bien, faites un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"commit\")), \" de votre repo (\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"web2\")), \") avec comme message : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"api-safe tutorial\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"En cas de souci, vous pouvez utiliser le code du tutoriel :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"pour le frontend : \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/jwt-fetch\"\n  }, \"jwt-fetch-hmi\"), \".\"), \"\\n\", React.createElement(_components.li, null, \"pour l'API : \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/safe\"\n  }, \"api-safe\"), \".\"), \"\\n\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" Projet 4.2 : Sécurisation d'API \")), \"\\n\", React.createElement(_components.p, null, \"Vous devez mettre à jour l'API développée pour \", React.createElement(_components.a, {\n    href: \"../auths-api/#project_4_1_authentification_autorisation_doperations\"\n  }, \"Projet 4.1\"), \" afin de sécuriser l'API pour échapper les caractères dangereux et pour hacher les password.\"), \"\\n\", React.createElement(_components.p, null, \"Le code doit se trouver dans votre repository local et votre web repository (normalement appelé \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"web2\")), \") dans le répertoire nommé \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/project/4.2/api\")), \" sur base d'un copier/coller du code de \", React.createElement(_components.a, {\n    href: \"../auths-api/#project_4_1_authentification_autorisation_doperations\"\n  }, \"Projet 4.1\"), \".\"), \"\\n\", React.createElement(AuthenticatedBlock, null, React.createElement(_components.p, null, \"Veuillez travailler avec les membres de votre groupe et vous partager le travail :\"), React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"certains membres peuvent travailler sur cette sécurisation ;\"), \"\\n\", React.createElement(_components.li, null, \"d'autres membres sur d'autres aspect du projet.\"), \"\\n\"), React.createElement(_components.p, null, \"Un peu avant la fin de la séance, veuillez discuter :\"), React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"présenter ce que vous avez appris au niveau de la sécurisation aux membres qui ont travaillé sur autre chose.\"), \"\\n\")), \"\\n\", React.createElement(_components.p, null, \"Vous devez tester, à l'aide de Rest Client, toutes les opérations que vous avez modifiées.\"), \"\\n\", React.createElement(_components.p, null, \"Quand un prototype d'api est finalisé et testé, veuillez faire un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"commit\")), \" de votre code avec comme message : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"4.2 : api bcrypt & escape-html\")), \".\"), \"\\n\", React.createElement(_components.h4, null, \"🤝 Tips\"), \"\\n\", React.createElement(_components.p, null, \"⚡ N'oubliez pas que vos méthodes de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \" et de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" deviennent asynchrones, cela impose de bien chaîner les traitements dans le router, sinon vous risquez de renvoyer des objets vides en réponses aux requêtes.\"), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" 🍬 Authentification & autorisation JWT à l'aide de cookies \")), \"\\n\", React.createElement(_components.h2, null, \"Pourquoi utiliser l'autorisation JWT à l'aide de cookies ?\"), \"\\n\", React.createElement(_components.p, null, \"Dans la partie sur l'\", React.createElement(_components.a, {\n    href: \"../auths-api/\"\n  }, \"Authentification et autorisation d'accès aux opérations d'une RESTful API via JWT\"), \", nous avons vu une façon de gérer des token JWT, sans gérer de cookies.\"), \"\\n\", React.createElement(_components.p, null, \"Cela impose aux client de sauvegarder les token et de les envoyer dans un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"authorization header\")), \" lorsqu'ils souhaitent accéder à une opération protégée.\"), \"\\n\", React.createElement(_components.p, null, \"Il est aussi possible d'intégrer les tokens au sein de cookies. Dans ce cas-là, les clients qui ont reçu un cookie de l'API renverront automatiquement ce cookie (mécanisme des browsers). Les tokens JWT voyageront automatiquement grâce au mécanisme de cookies.\"), \"\\n\", React.createElement(_components.p, null, \"💭 Faut-il mieux intégrer les token JWT dans des cookies ou pas ?\", React.createElement(_components.br), \"\\n\", \"Il est difficile de donner une réponse à cette question. Chaque approche a des avantages et des inconvénients. Ce qui devrait être le point d'attention, c'est la sécurité. Et dans les deux cas, on atteint un niveau de sécurité raisonnable.\\r\\nPour ce cours, nous avons choisi la façon la plus moderne, en laissant au client le choix de sauvegarder les token dans le web storage (nous allons voir ça tout prochainement pour l'aspect frontend).\", React.createElement(_components.br), \"\\n\", \"Notons que le cas le plus sûr est probablement d'avoir deux types de token, ce qui est d'une complexité qui dépasse les objectifs de ce cours. Néanmoins, pour votre info, les mécanismes d'authentification comme OAuth (authorization de MS Azure) & OpenID Connect (authentification de MS Azure) gère deux types de token :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"un token à durée de vie courte qui sera enregistré en mémoire vive au niveau du client (access token) ou dans le localStorage.\"), \"\\n\", React.createElement(_components.li, null, \"un token à durée de vie longue qui sera enregistré par le client dans un cookie (refresh token, notamment utilisé par l'API pour créer un nouvel access token).\"), \"\\n\"), \"\\n\", React.createElement(_components.h2, null, \"Un cookie, c'est quoi ?\"), \"\\n\", React.createElement(_components.p, null, \"Un \", React.createElement(_components.strong, null, \"cookie\"), \" représente des données qu'un serveur envoie à un browser.\", React.createElement(_components.br), \"\\n\", \"Le browser peut sauver ce cookie. Pour chaque requête faite au serveur sur la même origine (que l'origine où le cookie a été reçu), le cookie sera automatiquement envoyé au serveur.\"), \"\\n\", React.createElement(_components.p, null, \"Il fut un temps où les cookies étaient utilisés comme un mécanisme général de stockage de données côté client.\"), \"\\n\", React.createElement(_components.p, null, \"👍 Actuellement, si les cookies sont utilisés pour sauvegarder les données de session, il faut se protéger contre les attaques XSS et rendre les cookies inaccessibles au JavaScript : on utilise donc les cookies \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"HttpOnly\")), \" qui sont inaccessibles à la \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"Document.cookie API\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Pour la suite, on va donc voir :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"comment utiliser Express pour créer des cookies au niveau d'une API ;\"), \"\\n\", React.createElement(_components.li, null, \"comment rendre ces cookies inaccessibles aux attaques XSS en configurant \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"HttpOnly\")), \".\"), \"\\n\"), \"\\n\", React.createElement(_components.h2, null, \"Implémentation de l'authentification & l'autorisation JWT au sein de cookies\"), \"\\n\", React.createElement(_components.h3, null, \"Intro\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons donc créer une nouvelle version de l'API sauvegardant le token d'un utilisateur au sein d'un cookie, ainsi que son username, sans que ces infos soient accessible au JS côté client.\"), \"\\n\", React.createElement(_components.p, null, \"Pour ce faire nous allons utiliser la librairie \", React.createElement(_components.a, {\n    href: \"https://github.com/expressjs/cookie-session\"\n  }, \"cookie-session\"), \" qui permet d'enregistrer des données de session dans des cookies.\"), \"\\n\", React.createElement(_components.p, null, \"Nous allons maintenant continuer le développement de l'API \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/safe\"\n  }, \"safe\"), \".\"), \"\\n\", React.createElement(_components.p, null, \"Au sein de votre repo \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"web2\")), \", veuillez créer le projet nommé \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/web2/tutorials/pizzeria/api/cookies\")), \" sur base d'un copié/collé de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/web2/tutorials/pizzeria/api/safe\")), \" (ou \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/safe\"\n  }, \"api-safe\"), \").\"), \"\\n\", React.createElement(_components.p, null, \"Pour la suite du tutoriel, nous considérons que tous les chemins absolus démarrent du répertoire\\r\\n\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/web2/tutorials/pizzeria/api/cookies\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez installer la librairie \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookie-session\")), \" au sein de votre nouveau projet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookies\")), \" :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-bash\"\n  }, \"npm i cookie-session\\n\")), \"\\n\", React.createElement(_components.h3, null, \"Utilisation de la fonction middleware \", React.createElement(_components.strong, null, \"cookieSession\")), \"\\n\", React.createElement(_components.p, null, \"Veuillez mettre à jour \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/app.json\")), \" pour mettre en place la gestion de cookies :\"), \"\\n\", React.createElement(_components.pre, {\n    highlighting: \"4,12-21\"\n  }, React.createElement(_components.code, {\n    className: \"language-js\"\n  }, \"const express = require('express');\\r\\nconst cookieParser = require('cookie-parser');\\r\\nconst logger = require('morgan');\\r\\nconst cookieSession = require('cookie-session');\\r\\n\\r\\nconst usersRouter = require('./routes/users');\\r\\nconst pizzaRouter = require('./routes/pizzas');\\r\\nconst authsRouter = require('./routes/auths');\\r\\n\\r\\nconst app = express();\\r\\n\\r\\nconst expiryDateIn3Months = new Date(Date.now() + 1000 * 60 * 60 * 24 * 30 * 3);\\r\\nconst cookieSecreteKey = 'YouWouldnot!not!like!mypizza';\\r\\napp.use(\\r\\n  cookieSession({\\r\\n    name: 'user',\\r\\n    keys: [cookieSecreteKey],  \\r\\n    httpOnly: true,\\r\\n    expires: expiryDateIn3Months,\\r\\n  }),\\r\\n);\\r\\n\\r\\napp.use(logger('dev'));\\r\\napp.use(express.json());\\r\\napp.use(express.urlencoded({ extended: false }));\\r\\napp.use(cookieParser());\\r\\n\\r\\napp.use('/users', usersRouter);\\r\\napp.use('/pizzas', pizzaRouter);\\r\\napp.use('/auths', authsRouter);\\r\\n\\r\\nmodule.exports = app;\\n\")), \"\\n\", React.createElement(_components.p, null, \"Nous avons donc bien indiqué que le cookie est inaccessible au JS via : \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"httpOnly: true\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Nous avons fait en sorte que le cookie soit signé via la clé \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookieSecreteKey\")), \".\", React.createElement(_components.br), \"\\n\", \"Le mécanisme de signature correspond à ce qui a été vu dans le cadre des tokens JWT.\", React.createElement(_components.br), \"\\n\", \"Ainsi, si un cookie venait être modifié par un utilisateur, lors de la vérification du cookie, cela sera automatiquement détecté par la fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookieSession\")), \" et la session ne sera pas créée.\"), \"\\n\", React.createElement(_components.p, null, \"Pour info, la fonction middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookieSession\")), \" va créer deux cookies :\"), \"\\n\", React.createElement(_components.ul, null, \"\\n\", React.createElement(_components.li, null, \"un cookie portant comme nom la valeur de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"name\")), \" ; il est encodé en base64. N'hésitez pas à vous amuser à décoder un cookie généré par \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"cookieSession\")), \" sur \", React.createElement(_components.a, {\n    href: \"https://www.base64decode.org/\"\n  }, \"base64decode\"), \".\"), \"\\n\", React.createElement(_components.li, null, \"un cookie portant comme nom la valeur de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"name\")), \" + \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \".sig\")), \" : c'est la signature qui prévient contre le \\\"tempering\\\" (acte intentionnel mais non autorisé qui amène à la modification d'un système ou de données).\"), \"\\n\"), \"\\n\", React.createElement(_components.h3, null, \"Lecture et ajout de données de session via \", React.createElement(_components.code, null, \"req.session\")), \"\\n\", React.createElement(_components.p, null, \"Pour créer des données de session, il suffit de simplement les ajouter à l'objet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"req.session\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Dans le cadre de la RESTful API gérant les pizzas, cela est fait lors d'une opération de type \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"register\")), \" ou \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"login\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez mettre à jour le router \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/routes/auths.js\")), \" :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"17,19,33,35,38-42,44-47\"\n  }, React.createElement(_components.code, {\n    className: \"language-js\"\n  }, \"const express = require('express');\\r\\nconst { register, login } = require('../models/users');\\r\\n\\r\\nconst router = express.Router();\\r\\n\\r\\n/* Register a user */\\r\\nrouter.post('/register', async (req, res) => {\\r\\n  const username = req?.body?.username?.length !== 0 ? req.body.username : undefined;\\r\\n  const password = req?.body?.password?.length !== 0 ? req.body.password : undefined;\\r\\n\\r\\n  if (!username || !password) return res.sendStatus(400); // 400 Bad Request\\r\\n\\r\\n  const authenticatedUser = await register(username, password);\\r\\n\\r\\n  if (!authenticatedUser) return res.sendStatus(409); // 409 Conflict\\r\\n\\r\\n  createCookieSessionData(req, authenticatedUser);\\r\\n\\r\\n  return res.json({ username: authenticatedUser.username });\\r\\n});\\r\\n\\r\\n/* Login a user */\\r\\nrouter.post('/login', async (req, res) => {\\r\\n  const username = req?.body?.username?.length !== 0 ? req.body.username : undefined;\\r\\n  const password = req?.body?.password?.length !== 0 ? req.body.password : undefined;\\r\\n\\r\\n  if (!username || !password) return res.sendStatus(400); // 400 Bad Reques\\r\\n\\r\\n  const authenticatedUser = await login(username, password);\\r\\n\\r\\n  if (!authenticatedUser) return res.sendStatus(401); // 401 Unauthorized\\r\\n\\r\\n  createCookieSessionData(req, authenticatedUser);\\r\\n\\r\\n  return res.json({ username: authenticatedUser.username });\\r\\n});\\r\\n\\r\\n/* Logout a user */\\r\\nrouter.get('/logout', (req, res) => {\\r\\n  req.session = null;\\r\\n  return res.sendStatus();\\r\\n});\\r\\n\\r\\nfunction createCookieSessionData(req, authenticatedUser) {\\r\\n  req.session.username = authenticatedUser.username;\\r\\n  req.session.token = authenticatedUser.token;\\r\\n}\\r\\n\\r\\nmodule.exports = router;\\n\")), \"\\n\", React.createElement(_components.p, null, \"Dans le code ci-dessus, nous préparons les données de session qui seront écrites dans le cookie à l'aide de l'objet \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"req.session\")), \".\", React.createElement(_components.br), \"\\n\", \"Lorsque nous renvoyons du JSON aux clients, nous ne renvoyons plus le token, mais juste le username de l'utilisateur. L'application cliente, le browser, pourra utiliser cette info pour afficher le nom de l'utilisateur. Pour rappel, le browser n'a pas accès, via le JS, à l'info se trouvant dans le cookie.\"), \"\\n\", React.createElement(_components.p, null, \"Quand nous gérons une session via des cookies, il n'est pas évident de bien clôre une session. Nous avons créé une nouvelle opération de type \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"GET /auths/logout\")), \" qui permet d'effacer les données de session d'un utilisateur.\"), \"\\n\", React.createElement(_components.p, null, \"Il nous reste à changer le mécanisme d'autorisation.\\r\\nLes tokens ne seront plus reçu via un authorization header, mais via un cookie.\", React.createElement(_components.br), \"\\n\", \"Nous allons donc mettre à jour le middleware \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/utils/authorize\")), \" (1 seule ligne) :\"), \"\\n\", React.createElement(_components.pre, {\n    numbered: true,\n    highlighting: \"7\"\n  }, React.createElement(_components.code, {\n    className: \"language-js\"\n  }, \"const jwt = require('jsonwebtoken');\\r\\nconst { readOneUserFromUsername } = require('../models/users');\\r\\n\\r\\nconst jwtSecret = 'ilovemypizza!';\\r\\n\\r\\nconst authorize = (req, res, next) => {\\r\\n  const { token } = req.session;\\r\\n  if (!token) return res.sendStatus(401);\\r\\n\\r\\n  try {\\r\\n    const decoded = jwt.verify(token, jwtSecret);\\r\\n    console.log('decoded', decoded);\\r\\n    const { username } = decoded;\\r\\n\\r\\n    const existingUser = readOneUserFromUsername(username);\\r\\n\\r\\n    if (!existingUser) return res.sendStatus(401);\\r\\n\\r\\n    req.user = existingUser; // request.user object is available in all other middleware functions\\r\\n    return next();\\r\\n  } catch (err) {\\r\\n    console.error('authorize: ', err);\\r\\n    return res.sendStatus(401);\\r\\n  }\\r\\n};\\r\\n\\r\\nconst isAdmin = (req, res, next) => {\\r\\n  const { username } = req.user;\\r\\n\\r\\n  if (username !== 'admin') return res.sendStatus(403);\\r\\n  return next();\\r\\n};\\r\\n\\r\\nmodule.exports = { authorize, isAdmin };\\n\")), \"\\n\", React.createElement(_components.h1, null, React.createElement(InternalPageTitle, null, \" 🍬 Test via REST Client d'une RESTful API attendant des cookies \")), \"\\n\", React.createElement(_components.p, null, \"Il nous reste à tester nos requêtes via REST Client.\"), \"\\n\", React.createElement(_components.p, null, \"Il n'y a pas de nouvelles notions à apprendre pour utiliser REST Client avec des cookies : le comportement par défaut de REST Client, lorsqu'un cookie est renvoyé dans une réponse, est d'inclure ce cookie dans chaque requête vers la même origine.\"), \"\\n\", React.createElement(_components.p, null, \"Dès lors, pour tester l'API, il suffit d'enlever tous les authorization headers et de rajouter une requête pour tester l'effacement d'une session.\"), \"\\n\", React.createElement(_components.p, null, \"Veuillez tester les requêtes à l'aide de \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/REST Client/pizzas.http\")), \" :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-http\"\n  }, \"######### NORMAL OPERATION  ###########\\r\\n\\r\\n### Read all pizzas\\r\\nGET http://localhost:3000/pizzas\\r\\n\\r\\n### Read all pizzas with File variable\\r\\n@baseUrl = http://localhost:3000\\r\\nGET {{baseUrl}}/pizzas\\r\\n\\r\\n### Read all pizzas sorted by title (ascending)\\r\\nGET {{baseUrl}}/pizzas/?order=+title\\r\\n\\r\\n### Read all pizzas sorted by title (descending)\\r\\nGET {{baseUrl}}/pizzas/?order=-title\\r\\n\\r\\n### Read pizza identified by 2\\r\\nGET {{baseUrl}}/pizzas/2\\r\\n\\r\\n### Create a pizza by using the admin account\\r\\n#### First login as the admin\\r\\nPOST {{baseUrl}}/auths/login\\r\\nContent-Type: application/json\\r\\n\\r\\n{\\r\\n    \\\"username\\\":\\\"admin\\\",\\r\\n    \\\"password\\\":\\\"admin\\\"\\r\\n}\\r\\n\\r\\n#### Create a pizza with the admin token\\r\\nPOST {{baseUrl}}/pizzas\\r\\nContent-Type: application/json\\r\\n\\r\\n{\\r\\n    \\\"title\\\":\\\"Magic Green\\\",\\r\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\r\\n}\\r\\n\\r\\n### Delete pizza identified by 2 with the admin token\\r\\nDELETE {{baseUrl}}/pizzas/2\\r\\n\\r\\n### Update the pizza identified by 6 with the admin token\\r\\nPATCH {{baseUrl}}/pizzas/6\\r\\nContent-Type: application/json\\r\\n\\r\\n{\\r\\n    \\\"title\\\":\\\"Magic Green 2\\\"\\r\\n}\\r\\n\\r\\n\\r\\n######### ERROR OPERATION  ###########\\r\\n\\r\\n### 1. Create a pizza without a token\\r\\nPOST {{baseUrl}}/pizzas\\r\\nContent-Type: application/json\\r\\n\\r\\n{\\r\\n    \\\"title\\\":\\\"Magic Green\\\",\\r\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\r\\n}\\r\\n\\r\\n### 2. Create a pizza without being the admin, use manager account\\r\\n#### 2.1 First login as the manager\\r\\nPOST {{baseUrl}}/auths/login\\r\\nContent-Type: application/json\\r\\n\\r\\n{\\r\\n    \\\"username\\\":\\\"manager\\\",\\r\\n    \\\"password\\\":\\\"manager\\\"\\r\\n}\\r\\n\\r\\n#### 2.2 Try to create a pizza with the manager token\\r\\nPOST {{baseUrl}}/pizzas\\r\\nContent-Type: application/json\\r\\n\\r\\n{\\r\\n    \\\"title\\\":\\\"Magic Green\\\",\\r\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\r\\n}\\r\\n\\r\\n### Read pizza which does not exists\\r\\nGET {{baseUrl}}/pizzas/100\\r\\n\\r\\n### Create a pizza which lacks a property\\r\\nPOST {{baseUrl}}/pizzas\\r\\nContent-Type: application/json\\r\\n\\r\\n{\\r\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\r\\n}\\r\\n\\r\\n### Create a pizza without info for a property\\r\\nPOST {{baseUrl}}/pizzas\\r\\nContent-Type: application/json\\r\\n\\r\\n{\\r\\n    \\\"title\\\":\\\"\\\",\\r\\n    \\\"content\\\":\\\"Epinards, Brocolis, Olives vertes, Basilic\\\"\\r\\n}\\r\\n\\r\\n### Update for a pizza which does not exist\\r\\nPATCH {{baseUrl}}/pizzas/200\\r\\nContent-Type: application/json\\r\\n\\r\\n{\\r\\n    \\\"title\\\":\\\"Magic Green 2\\\"\\r\\n}\\r\\n\\r\\n### Update for a pizza which does not provide any info for a property\\r\\nPATCH {{baseUrl}}/pizzas/1\\r\\n\\r\\nContent-Type: application/json\\r\\n\\r\\n{\\r\\n    \\\"title\\\":\\\"Magic Green 2\\\",\\r\\n    \\\"content\\\":\\\"\\\"\\r\\n}\\n\")), \"\\n\", React.createElement(_components.p, null, React.createElement(_components.strong, null, React.createElement(_components.code, null, \"/REST Client/auths.http\")), \" a été mis à jour pour tester \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"GET /auths/logout\")), \" :\"), \"\\n\", React.createElement(_components.pre, null, React.createElement(_components.code, {\n    className: \"language-http\"\n  }, \"### Logout any user\\r\\nGET {{baseUrl}}/auths/logout\\n\")), \"\\n\", React.createElement(_components.p, null, \"Pour ajouter une pizza, il suffit juste :\"), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"De loguer l'admin.\"), \"\\n\", React.createElement(_components.li, null, \"De créer une nouvelle pizza ; le cookie est automatiquement envoyé.\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Admettons que vous souhaitez tester l'ajout d'une pizza sans envoyer de token :\"), \"\\n\", React.createElement(_components.ol, null, \"\\n\", React.createElement(_components.li, null, \"Lancez l'opération de logout (\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"GET /auths/logout\")), \") ; le cookie renvoyé ne contient pas de données de session ;\"), \"\\n\", React.createElement(_components.li, null, \"Tentez la création d'une pizza qui renverra un code \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"401 Unauthorized\")), \".\"), \"\\n\"), \"\\n\", React.createElement(_components.p, null, \"Si tout fonctionne bien, faites un \", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"commit\")), \" de votre repo (\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"web2\")), \") avec comme message :\\r\\n\", React.createElement(_components.strong, null, React.createElement(_components.code, null, \"api-cookies tutorial\")), \".\"), \"\\n\", React.createElement(_components.p, null, \"En cas de souci, vous pouvez utiliser le code du tutoriel \", React.createElement(_components.a, {\n    href: \"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/cookies\"\n  }, \"api-cookies\"), \".\"));\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props)) : _createMdxContent(props);\n}\nexport default MDXContent;\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","import GATSBY_COMPILED_MDX from \"D:/Vinci/code/web2/js-course/frontend/src/mdx-pages/part4/security-api.fr.mdx\";\nimport React from 'react';\nimport {graphql} from 'gatsby';\nimport {MDXProvider} from '@mdx-js/react';\nimport {Link} from 'gatsby';\nimport MainLayout from '../components/main-layout.js';\nimport Image from '../components/image.js';\nimport Section from '../components/section.js';\nimport Content from '../components/content.js';\nimport Background from '../components/background.js';\nimport SectionHeader from '../components/section-header.js';\nimport SectionFooter from '../components/section-footer.js';\nimport PageHeader from '../components/page-header.js';\nimport {withFrontmatter} from '../components/hoc/hoc.js';\nimport CodeBlock from '../components/codeblock/codeblock.js';\nimport LinkFile from '../components/file/link-file.js';\nimport ScrollableImage from '../components/image/scrollable-image';\nimport PublicProjectsView from '../components/public-projects/public-projects-view';\nimport {AuthenticatedTemplate, UnauthenticatedTemplate} from '@azure/msal-react';\nimport AuthenticatedBlock from '../components/auth/authenticated-block.js';\nimport UnAuthenticatedBlock from '../components/auth/unauthenticated-block.js';\nimport NestedMdxBlock from '../components/mdx/nested-mdx-block.js';\nimport YoutubeImage from '../components/image/youtube-image.js';\nimport InternalPageMenu from '../components/internal-page-menu/internal-page-menu.js';\nimport InternalPageMenuItem from '../components/internal-page-menu/internal-page-menu-item.js';\nimport InternalPageTitle from '../components/internal-page-menu/menu-title.js';\nimport {PathViewer, PathViewerItem} from '../components/path-viewer/path-viewer.js';\nconst shortcodes = {\n  Link,\n  Image,\n  Section,\n  Content,\n  Background,\n  SectionHeader,\n  SectionFooter,\n  PageHeader,\n  CodeBlock,\n  LinkFile,\n  ScrollableImage,\n  PublicProjectsView,\n  AuthenticatedBlock,\n  UnAuthenticatedBlock,\n  NestedMdxBlock,\n  YoutubeImage,\n  InternalPageMenu,\n  InternalPageMenuItem,\n  InternalPageTitle,\n  PathViewer,\n  PathViewerItem\n};\nfunction PageTemplate({data: {mdx, allImages}, children}) {\n  shortcodes.PageHeader = withFrontmatter(PageHeader, mdx?.frontmatter);\n  return React.createElement(MainLayout, Object.assign({}, mdx?.frontmatter ? {\n    frontmatter: mdx.frontmatter\n  } : {}, mdx?.frontmatter?.navbarExtraStyles ? {\n    navbarExtraStyles: mdx.frontmatter.navbarExtraStyles\n  } : {}, mdx?.frontmatter?.headerImage ? {\n    headerImage: mdx.frontmatter.headerImage\n  } : {}, mdx?.frontmatter?.featuredImage ? {\n    featuredImage: mdx.frontmatter.featuredImage\n  } : {}, mdx?.frontmatter?.title ? {\n    pageTitle: mdx.frontmatter.title\n  } : {}, allImages && allImages.length > 0 ? {\n    allImages: allImages\n  } : {}), React.createElement(MDXProvider, {\n    components: shortcodes\n  }, React.createElement(\"div\", {\n    className: mdx?.frontmatter?.autoMargin ? 'page page--auto-margin ' : 'page'\n  }, children)));\n}\nexport default function GatsbyMDXWrapper(props) {\n  return React.createElement(PageTemplate, props, React.createElement(GATSBY_COMPILED_MDX, props));\n}\nexport const pageQuery = graphql`\n  query pagesAndImages($slug: String) {\n    mdx(fields: { slug: { eq: $slug } }) {\n      id\n      body\n      fields {\n        slug\n      }\n\n      frontmatter {\n        title\n        date\n        navbarExtraStyles\n        headerImage\n        featuredImage\n        description\n        autoMargin\n      }\n    }\n    allImages: allFile(\n      filter: {\n        sourceInstanceName: { eq: \"images\" }\n        extension: { nin: [\"ico\", \"svg\"] }\n      }\n    ) {\n      edges {\n        node {\n          childImageSharp {\n            gatsbyImageData(\n              quality: 90\n              layout: FULL_WIDTH\n              placeholder: TRACED_SVG\n              tracedSVGOptions: { color: \"green\", background: \"grey\" }\n            )\n          }\n          base\n        }\n      }\n    }\n  }\n`;\n"],"names":["_createMdxContent","props","_components","Object","assign","h1","p","br","h2","strong","code","a","pre","em","ul","li","h4","h3","ol","_provideComponents","components","InternalPageMenu","PathViewer","PathViewerItem","InternalPageMenuItem","InternalPageTitle","ScrollableImage","AuthenticatedBlock","_missingMdxReference","React","to","selected","name","minWidth","maxWidth","href","className","highlighting","numbered","MDXLayout","wrapper","id","component","Error","shortcodes","Link","Image","Section","Content","Background","SectionHeader","SectionFooter","PageHeader","CodeBlock","LinkFile","PublicProjectsView","UnAuthenticatedBlock","NestedMdxBlock","YoutubeImage","PageTemplate","data","mdx","allImages","children","withFrontmatter","frontmatter","MainLayout","navbarExtraStyles","headerImage","featuredImage","title","pageTitle","length","MDXProvider","autoMargin","GatsbyMDXWrapper","GATSBY_COMPILED_MDX"],"sourceRoot":""}